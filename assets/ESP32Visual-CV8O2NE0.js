import{r as v,j as ye,m as ts,e as Gn,u as ns,a as rs,b as ss,c as is,d as as,i as os,E as cs,B as ls,f as us,T as ds,g as Ee,h as hs,k as Xt,D as Wn,V as J,l as Fe,P as Gt,O as At,M as hn,I as fs,S as Kt,v as Er,n as sr,Q as It,o as kt,p as Ht,R as ps,q as ms,s as Tr,H as He,F as ut,t as jt,L as Be,w as ln,x as gs,U as vs,y as ys,z as sn,A as ws,C as Zn,G as xr,J as Lt,K as lt,N as br,W as Kn,X as Vt,Y as Tn,Z as Es,_ as Ts,$ as je,a0 as vt,a1 as zt,a2 as xs,a3 as bs,a4 as _s,a5 as Ms,a6 as Dn,a7 as wt,a8 as Vn,a9 as Rs,aa as ir,ab as dt,ac as Ss,ad as un,ae as As,af as Is,ag as Ls,ah as _r,ai as Cs,aj as ar,ak as Os,al as tt,am as xn,an as Ps,ao as Ds,ap as Ns,aq as Nn,ar as Mr,as as Rr,at as an,au as Fn,av as on,aw as st,ax as Fs,ay as Us,az as ks,aA as Hs,aB as Bs,aC as Sr,aD as js,aE as zs,aF as Gs,aG as Ar,aH as Ws,aI as Zs,aJ as Ks,aK as Un,aL as Vs,aM as Xs,aN as Rn,aO as Ys,aP as Ir,aQ as $s,aR as qs,aS as Qs,aT as Js,aU as ei,aV as ti,aW as Sn,aX as ni,aY as ri,aZ as si,a_ as ii,a$ as Lr,b0 as ai,b1 as or,b2 as cr,b3 as lr,b4 as oi,b5 as ci}from"./index-CanB1Tb8.js";function $e(){return $e=Object.assign?Object.assign.bind():function(o){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)({}).hasOwnProperty.call(n,t)&&(o[t]=n[t])}return o},$e.apply(null,arguments)}function ur(o,e){let n;return(...t)=>{window.clearTimeout(n),n=window.setTimeout(()=>o(...t),e)}}function li({debounce:o,scroll:e,polyfill:n,offsetSize:t}={debounce:0,scroll:!1,offsetSize:!1}){const r=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[i,s]=v.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),c=v.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:i,orientationHandler:null}),l=o?typeof o=="number"?o:o.scroll:null,u=o?typeof o=="number"?o:o.resize:null,f=v.useRef(!1);v.useEffect(()=>(f.current=!0,()=>void(f.current=!1)));const[h,p,y]=v.useMemo(()=>{const x=()=>{if(!c.current.element)return;const{left:_,top:F,width:O,height:A,bottom:w,right:P,x:L,y:I}=c.current.element.getBoundingClientRect(),C={left:_,top:F,width:O,height:A,bottom:w,right:P,x:L,y:I};c.current.element instanceof HTMLElement&&t&&(C.height=c.current.element.offsetHeight,C.width=c.current.element.offsetWidth),Object.freeze(C),f.current&&!fi(c.current.lastBounds,C)&&s(c.current.lastBounds=C)};return[x,u?ur(x,u):x,l?ur(x,l):x]},[s,t,l,u]);function M(){c.current.scrollContainers&&(c.current.scrollContainers.forEach(x=>x.removeEventListener("scroll",y,!0)),c.current.scrollContainers=null),c.current.resizeObserver&&(c.current.resizeObserver.disconnect(),c.current.resizeObserver=null),c.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",c.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",c.current.orientationHandler))}function b(){c.current.element&&(c.current.resizeObserver=new r(y),c.current.resizeObserver.observe(c.current.element),e&&c.current.scrollContainers&&c.current.scrollContainers.forEach(x=>x.addEventListener("scroll",y,{capture:!0,passive:!0})),c.current.orientationHandler=()=>{y()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",c.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",c.current.orientationHandler))}const T=x=>{!x||x===c.current.element||(M(),c.current.element=x,c.current.scrollContainers=Cr(x),b())};return di(y,!!e),ui(p),v.useEffect(()=>{M(),b()},[e,y,p]),v.useEffect(()=>M,[]),[T,i,h]}function ui(o){v.useEffect(()=>{const e=o;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[o])}function di(o,e){v.useEffect(()=>{if(e){const n=o;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[o,e])}function Cr(o){const e=[];if(!o||o===document.body)return e;const{overflow:n,overflowX:t,overflowY:r}=window.getComputedStyle(o);return[n,t,r].some(i=>i==="auto"||i==="scroll")&&e.push(o),[...e,...Cr(o.parentElement)]}const hi=["x","y","top","bottom","left","right","width","height"],fi=(o,e)=>hi.every(n=>o[n]===e[n]);function pi({ref:o,children:e,fallback:n,resize:t,style:r,gl:i,events:s=as,eventSource:c,eventPrefix:l,shadows:u,linear:f,flat:h,legacy:p,orthographic:y,frameloop:M,dpr:b,performance:T,raycaster:x,camera:_,scene:F,onPointerMissed:O,onCreated:A,...w}){v.useMemo(()=>Gn(ds),[]);const P=ns(),[L,I]=li({scroll:!0,debounce:{scroll:50,resize:0},...t}),C=v.useRef(null),Z=v.useRef(null);v.useImperativeHandle(o,()=>C.current);const Q=rs(O),[V,G]=v.useState(!1),[X,q]=v.useState(!1);if(V)throw V;if(X)throw X;const ae=v.useRef(null);ss(()=>{const he=C.current;if(I.width>0&&I.height>0&&he){ae.current||(ae.current=is(he));async function te(){await ae.current.configure({gl:i,scene:F,events:s,shadows:u,linear:f,flat:h,legacy:p,orthographic:y,frameloop:M,dpr:b,performance:T,raycaster:x,camera:_,size:I,onPointerMissed:(...ue)=>Q.current==null?void 0:Q.current(...ue),onCreated:ue=>{ue.events.connect==null||ue.events.connect(c?os(c)?c.current:c:Z.current),l&&ue.setEvents({compute:(re,se)=>{const Me=re[l+"X"],Ne=re[l+"Y"];se.pointer.set(Me/se.size.width*2-1,-(Ne/se.size.height)*2+1),se.raycaster.setFromCamera(se.pointer,se.camera)}}),A?.(ue)}}),ae.current.render(ye.jsx(P,{children:ye.jsx(cs,{set:q,children:ye.jsx(v.Suspense,{fallback:ye.jsx(ls,{set:G}),children:e??null})})}))}te()}}),v.useEffect(()=>{const he=C.current;if(he)return()=>us(he)},[]);const xe=c?"none":"auto";return ye.jsx("div",{ref:Z,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:xe,...r},...w,children:ye.jsx("div",{ref:L,style:{width:"100%",height:"100%"},children:ye.jsx("canvas",{ref:C,style:{display:"block"},children:n})})})}function mi(o){return ye.jsx(ts,{children:ye.jsx(pi,{...o})})}const fn=new J,Xn=new J,gi=new J,dr=new Fe;function vi(o,e,n){const t=fn.setFromMatrixPosition(o.matrixWorld);t.project(e);const r=n.width/2,i=n.height/2;return[t.x*r+r,-(t.y*i)+i]}function yi(o,e){const n=fn.setFromMatrixPosition(o.matrixWorld),t=Xn.setFromMatrixPosition(e.matrixWorld),r=n.sub(t),i=e.getWorldDirection(gi);return r.angleTo(i)>Math.PI/2}function wi(o,e,n,t){const r=fn.setFromMatrixPosition(o.matrixWorld),i=r.clone();i.project(e),dr.set(i.x,i.y),n.setFromCamera(dr,e);const s=n.intersectObjects(t,!0);if(s.length){const c=s[0].distance;return r.distanceTo(n.ray.origin)<c}return!0}function Ei(o,e){if(e instanceof At)return e.zoom;if(e instanceof Gt){const n=fn.setFromMatrixPosition(o.matrixWorld),t=Xn.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,i=n.distanceTo(t);return 1/(2*Math.tan(r/2)*i)}else return 1}function Ti(o,e,n){if(e instanceof Gt||e instanceof At){const t=fn.setFromMatrixPosition(o.matrixWorld),r=Xn.setFromMatrixPosition(e.matrixWorld),i=t.distanceTo(r),s=(n[1]-n[0])/(e.far-e.near),c=n[1]-s*e.far;return Math.round(s*i+c)}}const kn=o=>Math.abs(o)<1e-10?0:o;function Or(o,e,n=""){let t="matrix3d(";for(let r=0;r!==16;r++)t+=kn(e[r]*o.elements[r])+(r!==15?",":")");return n+t}const xi=(o=>e=>Or(e,o))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),bi=(o=>(e,n)=>Or(e,o(n),"translate(-50%,-50%)"))(o=>[1/o,1/o,1/o,1,-1/o,-1/o,-1/o,-1,1/o,1/o,1/o,1,1,1,1,1]);function _i(o){return o&&typeof o=="object"&&"current"in o}const Mi=v.forwardRef(({children:o,eps:e=.001,style:n,className:t,prepend:r,center:i,fullscreen:s,portal:c,distanceFactor:l,sprite:u=!1,transform:f=!1,occlude:h,onOcclude:p,castShadow:y,receiveShadow:M,material:b,geometry:T,zIndexRange:x=[16777271,0],calculatePosition:_=vi,as:F="div",wrapperClass:O,pointerEvents:A="auto",...w},P)=>{const{gl:L,camera:I,scene:C,size:Z,raycaster:Q,events:V,viewport:G}=Ee(),[X]=v.useState(()=>document.createElement(F)),q=v.useRef(null),ae=v.useRef(null),xe=v.useRef(0),he=v.useRef([0,0]),te=v.useRef(null),ue=v.useRef(null),re=c?.current||V.connected||L.domElement.parentNode,se=v.useRef(null),Me=v.useRef(!1),Ne=v.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&_i(h[0]),[h]);v.useLayoutEffect(()=>{const Ie=L.domElement;h&&h==="blending"?(Ie.style.zIndex=`${Math.floor(x[0]/2)}`,Ie.style.position="absolute",Ie.style.pointerEvents="none"):(Ie.style.zIndex=null,Ie.style.position=null,Ie.style.pointerEvents=null)},[h]),v.useLayoutEffect(()=>{if(ae.current){const Ie=q.current=hs.createRoot(X);if(C.updateMatrixWorld(),f)X.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const de=_(ae.current,I,Z);X.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${de[0]}px,${de[1]}px,0);transform-origin:0 0;`}return re&&(r?re.prepend(X):re.appendChild(X)),()=>{re&&re.removeChild(X),Ie.unmount()}}},[re,f]),v.useLayoutEffect(()=>{O&&(X.className=O)},[O]);const ce=v.useMemo(()=>f?{position:"absolute",top:0,left:0,width:Z.width,height:Z.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:i?"translate3d(-50%,-50%,0)":"none",...s&&{top:-Z.height/2,left:-Z.width/2,width:Z.width,height:Z.height},...n},[n,i,s,Z,f]),Ue=v.useMemo(()=>({position:"absolute",pointerEvents:A}),[A]);v.useLayoutEffect(()=>{if(Me.current=!1,f){var Ie;(Ie=q.current)==null||Ie.render(v.createElement("div",{ref:te,style:ce},v.createElement("div",{ref:ue,style:Ue},v.createElement("div",{ref:P,className:t,style:n,children:o}))))}else{var de;(de=q.current)==null||de.render(v.createElement("div",{ref:P,style:ce,className:t,children:o}))}});const Se=v.useRef(!0);Xt(Ie=>{if(ae.current){I.updateMatrixWorld(),ae.current.updateWorldMatrix(!0,!1);const de=f?he.current:_(ae.current,I,Z);if(f||Math.abs(xe.current-I.zoom)>e||Math.abs(he.current[0]-de[0])>e||Math.abs(he.current[1]-de[1])>e){const ze=yi(ae.current,I);let Oe=!1;Ne&&(Array.isArray(h)?Oe=h.map(Ge=>Ge.current):h!=="blending"&&(Oe=[C]));const qe=Se.current;if(Oe){const Ge=wi(ae.current,I,Q,Oe);Se.current=Ge&&!ze}else Se.current=!ze;qe!==Se.current&&(p?p(!Se.current):X.style.display=Se.current?"block":"none");const it=Math.floor(x[0]/2),Yt=h?Ne?[x[0],it]:[it-1,0]:x;if(X.style.zIndex=`${Ti(ae.current,I,Yt)}`,f){const[Ge,Et]=[Z.width/2,Z.height/2],ht=I.projectionMatrix.elements[5]*Et,{isOrthographicCamera:Ot,top:$t,left:Pt,bottom:ft,right:at}=I,Tt=xi(I.matrixWorldInverse),qt=Ot?`scale(${ht})translate(${kn(-(at+Pt)/2)}px,${kn(($t+ft)/2)}px)`:`translateZ(${ht}px)`;let We=ae.current.matrixWorld;u&&(We=I.matrixWorldInverse.clone().transpose().copyPosition(We).scale(ae.current.scale),We.elements[3]=We.elements[7]=We.elements[11]=0,We.elements[15]=1),X.style.width=Z.width+"px",X.style.height=Z.height+"px",X.style.perspective=Ot?"":`${ht}px`,te.current&&ue.current&&(te.current.style.transform=`${qt}${Tt}translate(${Ge}px,${Et}px)`,ue.current.style.transform=bi(We,1/((l||10)/400)))}else{const Ge=l===void 0?1:Ei(ae.current,I)*l;X.style.transform=`translate3d(${de[0]}px,${de[1]}px,0) scale(${Ge})`}he.current=de,xe.current=I.zoom}}if(!Ne&&se.current&&!Me.current)if(f){if(te.current){const de=te.current.children[0];if(de!=null&&de.clientWidth&&de!=null&&de.clientHeight){const{isOrthographicCamera:ze}=I;if(ze||T)w.scale&&(Array.isArray(w.scale)?w.scale instanceof J?se.current.scale.copy(w.scale.clone().divideScalar(1)):se.current.scale.set(1/w.scale[0],1/w.scale[1],1/w.scale[2]):se.current.scale.setScalar(1/w.scale));else{const Oe=(l||10)/400,qe=de.clientWidth*Oe,it=de.clientHeight*Oe;se.current.scale.set(qe,it,1)}Me.current=!0}}}else{const de=X.children[0];if(de!=null&&de.clientWidth&&de!=null&&de.clientHeight){const ze=1/G.factor,Oe=de.clientWidth*ze,qe=de.clientHeight*ze;se.current.scale.set(Oe,qe,1),Me.current=!0}se.current.lookAt(Ie.camera.position)}});const Ct=v.useMemo(()=>({vertexShader:f?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[f]);return v.createElement("group",$e({},w,{ref:ae}),h&&!Ne&&v.createElement("mesh",{castShadow:y,receiveShadow:M,ref:se},T||v.createElement("planeGeometry",null),b||v.createElement("shaderMaterial",{side:Wn,vertexShader:Ct.vertexShader,fragmentShader:Ct.fragmentShader})))});var Ye=Uint8Array,yt=Uint16Array,Hn=Uint32Array,Pr=new Ye([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Dr=new Ye([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ri=new Ye([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nr=function(o,e){for(var n=new yt(31),t=0;t<31;++t)n[t]=e+=1<<o[t-1];for(var r=new Hn(n[30]),t=1;t<30;++t)for(var i=n[t];i<n[t+1];++i)r[i]=i-n[t]<<5|t;return[n,r]},Fr=Nr(Pr,2),Ur=Fr[0],Si=Fr[1];Ur[28]=258,Si[258]=28;var Ai=Nr(Dr,0),Ii=Ai[0],Bn=new yt(32768);for(var Te=0;Te<32768;++Te){var mt=(Te&43690)>>>1|(Te&21845)<<1;mt=(mt&52428)>>>2|(mt&13107)<<2,mt=(mt&61680)>>>4|(mt&3855)<<4,Bn[Te]=((mt&65280)>>>8|(mt&255)<<8)>>>1}var cn=function(o,e,n){for(var t=o.length,r=0,i=new yt(e);r<t;++r)++i[o[r]-1];var s=new yt(e);for(r=0;r<e;++r)s[r]=s[r-1]+i[r-1]<<1;var c;if(n){c=new yt(1<<e);var l=15-e;for(r=0;r<t;++r)if(o[r])for(var u=r<<4|o[r],f=e-o[r],h=s[o[r]-1]++<<f,p=h|(1<<f)-1;h<=p;++h)c[Bn[h]>>>l]=u}else for(c=new yt(t),r=0;r<t;++r)o[r]&&(c[r]=Bn[s[o[r]-1]++]>>>15-o[r]);return c},pn=new Ye(288);for(var Te=0;Te<144;++Te)pn[Te]=8;for(var Te=144;Te<256;++Te)pn[Te]=9;for(var Te=256;Te<280;++Te)pn[Te]=7;for(var Te=280;Te<288;++Te)pn[Te]=8;var kr=new Ye(32);for(var Te=0;Te<32;++Te)kr[Te]=5;var Li=cn(pn,9,1),Ci=cn(kr,5,1),An=function(o){for(var e=o[0],n=1;n<o.length;++n)o[n]>e&&(e=o[n]);return e},et=function(o,e,n){var t=e/8|0;return(o[t]|o[t+1]<<8)>>(e&7)&n},In=function(o,e){var n=e/8|0;return(o[n]|o[n+1]<<8|o[n+2]<<16)>>(e&7)},Oi=function(o){return(o/8|0)+(o&7&&1)},Pi=function(o,e,n){(n==null||n>o.length)&&(n=o.length);var t=new(o instanceof yt?yt:o instanceof Hn?Hn:Ye)(n-e);return t.set(o.subarray(e,n)),t},Di=function(o,e,n){var t=o.length;if(!t||n&&!n.l&&t<5)return e||new Ye(0);var r=!e||n,i=!n||n.i;n||(n={}),e||(e=new Ye(t*3));var s=function(ce){var Ue=e.length;if(ce>Ue){var Se=new Ye(Math.max(Ue*2,ce));Se.set(e),e=Se}},c=n.f||0,l=n.p||0,u=n.b||0,f=n.l,h=n.d,p=n.m,y=n.n,M=t*8;do{if(!f){n.f=c=et(o,l,1);var b=et(o,l+1,3);if(l+=3,b)if(b==1)f=Li,h=Ci,p=9,y=5;else if(b==2){var F=et(o,l,31)+257,O=et(o,l+10,15)+4,A=F+et(o,l+5,31)+1;l+=14;for(var w=new Ye(A),P=new Ye(19),L=0;L<O;++L)P[Ri[L]]=et(o,l+L*3,7);l+=O*3;for(var I=An(P),C=(1<<I)-1,Z=cn(P,I,1),L=0;L<A;){var Q=Z[et(o,l,C)];l+=Q&15;var T=Q>>>4;if(T<16)w[L++]=T;else{var V=0,G=0;for(T==16?(G=3+et(o,l,3),l+=2,V=w[L-1]):T==17?(G=3+et(o,l,7),l+=3):T==18&&(G=11+et(o,l,127),l+=7);G--;)w[L++]=V}}var X=w.subarray(0,F),q=w.subarray(F);p=An(X),y=An(q),f=cn(X,p,1),h=cn(q,y,1)}else throw"invalid block type";else{var T=Oi(l)+4,x=o[T-4]|o[T-3]<<8,_=T+x;if(_>t){if(i)throw"unexpected EOF";break}r&&s(u+x),e.set(o.subarray(T,_),u),n.b=u+=x,n.p=l=_*8;continue}if(l>M){if(i)throw"unexpected EOF";break}}r&&s(u+131072);for(var ae=(1<<p)-1,xe=(1<<y)-1,he=l;;he=l){var V=f[In(o,l)&ae],te=V>>>4;if(l+=V&15,l>M){if(i)throw"unexpected EOF";break}if(!V)throw"invalid length/literal";if(te<256)e[u++]=te;else if(te==256){he=l,f=null;break}else{var ue=te-254;if(te>264){var L=te-257,re=Pr[L];ue=et(o,l,(1<<re)-1)+Ur[L],l+=re}var se=h[In(o,l)&xe],Me=se>>>4;if(!se)throw"invalid distance";l+=se&15;var q=Ii[Me];if(Me>3){var re=Dr[Me];q+=In(o,l)&(1<<re)-1,l+=re}if(l>M){if(i)throw"unexpected EOF";break}r&&s(u+131072);for(var Ne=u+ue;u<Ne;u+=4)e[u]=e[u-q],e[u+1]=e[u+1-q],e[u+2]=e[u+2-q],e[u+3]=e[u+3-q];u=Ne}}n.l=f,n.p=he,n.b=u,f&&(c=1,n.m=p,n.d=h,n.n=y)}while(!c);return u==e.length?e:Pi(e,0,u)},Ni=new Ye(0),Fi=function(o){if((o[0]&15)!=8||o[0]>>>4>7||(o[0]<<8|o[1])%31)throw"invalid zlib data";if(o[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function yn(o,e){return Di((Fi(o),o.subarray(2,-4)),e)}var Ui=typeof TextDecoder<"u"&&new TextDecoder,ki=0;try{Ui.decode(Ni,{stream:!0}),ki=1}catch{}const Hi=o=>o&&o.isCubeTexture;class Bi extends hn{constructor(e,n){var t,r;const i=Hi(e),c=((r=i?(t=e.image[0])==null?void 0:t.width:e.image.width)!=null?r:1024)/4,l=Math.floor(Math.log2(c)),u=Math.pow(2,l),f=3*Math.max(u,112),h=4*u,p=[i?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/f}`,`#define CUBEUV_TEXEL_HEIGHT ${1/h}`,`#define CUBEUV_MAX_MIP ${l}.0`],y=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,M=p.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Er>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,b={map:{value:e},height:{value:n?.height||15},radius:{value:n?.radius||100}},T=new fs(1,16),x=new Kt({uniforms:b,fragmentShader:M,vertexShader:y,side:Wn});super(T,x)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var ji=Object.defineProperty,zi=(o,e,n)=>e in o?ji(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n,Gi=(o,e,n)=>(zi(o,e+"",n),n);class Wi{constructor(){Gi(this,"_listeners")}addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const t=this._listeners;t[e]===void 0&&(t[e]=[]),t[e].indexOf(n)===-1&&t[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const t=this._listeners;return t[e]!==void 0&&t[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const r=t.slice(0);for(let i=0,s=r.length;i<s;i++)r[i].call(this,e);e.target=null}}}var Zi=Object.defineProperty,Ki=(o,e,n)=>e in o?Zi(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n,$=(o,e,n)=>(Ki(o,typeof e!="symbol"?e+"":e,n),n);const wn=new ps,hr=new ms,Vi=Math.cos(70*(Math.PI/180)),fr=(o,e)=>(o%e+e)%e;let Xi=class extends Wi{constructor(e,n){super(),$(this,"object"),$(this,"domElement"),$(this,"enabled",!0),$(this,"target",new J),$(this,"minDistance",0),$(this,"maxDistance",1/0),$(this,"minZoom",0),$(this,"maxZoom",1/0),$(this,"minPolarAngle",0),$(this,"maxPolarAngle",Math.PI),$(this,"minAzimuthAngle",-1/0),$(this,"maxAzimuthAngle",1/0),$(this,"enableDamping",!1),$(this,"dampingFactor",.05),$(this,"enableZoom",!0),$(this,"zoomSpeed",1),$(this,"enableRotate",!0),$(this,"rotateSpeed",1),$(this,"enablePan",!0),$(this,"panSpeed",1),$(this,"screenSpacePanning",!0),$(this,"keyPanSpeed",7),$(this,"zoomToCursor",!1),$(this,"autoRotate",!1),$(this,"autoRotateSpeed",2),$(this,"reverseOrbit",!1),$(this,"reverseHorizontalOrbit",!1),$(this,"reverseVerticalOrbit",!1),$(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),$(this,"mouseButtons",{LEFT:kt.ROTATE,MIDDLE:kt.DOLLY,RIGHT:kt.PAN}),$(this,"touches",{ONE:Ht.ROTATE,TWO:Ht.DOLLY_PAN}),$(this,"target0"),$(this,"position0"),$(this,"zoom0"),$(this,"_domElementKeyEvents",null),$(this,"getPolarAngle"),$(this,"getAzimuthalAngle"),$(this,"setPolarAngle"),$(this,"setAzimuthalAngle"),$(this,"getDistance"),$(this,"getZoomScale"),$(this,"listenToKeyEvents"),$(this,"stopListenToKeyEvents"),$(this,"saveState"),$(this,"reset"),$(this,"update"),$(this,"connect"),$(this,"dispose"),$(this,"dollyIn"),$(this,"dollyOut"),$(this,"getScale"),$(this,"setScale"),this.object=e,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>f.phi,this.getAzimuthalAngle=()=>f.theta,this.setPolarAngle=g=>{let N=fr(g,2*Math.PI),W=f.phi;W<0&&(W+=2*Math.PI),N<0&&(N+=2*Math.PI);let le=Math.abs(N-W);2*Math.PI-le<le&&(N<W?N+=2*Math.PI:W+=2*Math.PI),h.phi=N-W,t.update()},this.setAzimuthalAngle=g=>{let N=fr(g,2*Math.PI),W=f.theta;W<0&&(W+=2*Math.PI),N<0&&(N+=2*Math.PI);let le=Math.abs(N-W);2*Math.PI-le<le&&(N<W?N+=2*Math.PI:W+=2*Math.PI),h.theta=N-W,t.update()},this.getDistance=()=>t.object.position.distanceTo(t.target),this.listenToKeyEvents=g=>{g.addEventListener("keydown",Dt),this._domElementKeyEvents=g},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Dt),this._domElementKeyEvents=null},this.saveState=()=>{t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=()=>{t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(r),t.update(),l=c.NONE},this.update=(()=>{const g=new J,N=new J(0,1,0),W=new It().setFromUnitVectors(e.up,N),le=W.clone().invert(),k=new J,Pe=new It,nt=2*Math.PI;return function(){const gn=t.object.position;W.setFromUnitVectors(e.up,N),le.copy(W).invert(),g.copy(gn).sub(t.target),g.applyQuaternion(W),f.setFromVector3(g),t.autoRotate&&l===c.NONE&&G(Q()),t.enableDamping?(f.theta+=h.theta*t.dampingFactor,f.phi+=h.phi*t.dampingFactor):(f.theta+=h.theta,f.phi+=h.phi);let Qe=t.minAzimuthAngle,Je=t.maxAzimuthAngle;isFinite(Qe)&&isFinite(Je)&&(Qe<-Math.PI?Qe+=nt:Qe>Math.PI&&(Qe-=nt),Je<-Math.PI?Je+=nt:Je>Math.PI&&(Je-=nt),Qe<=Je?f.theta=Math.max(Qe,Math.min(Je,f.theta)):f.theta=f.theta>(Qe+Je)/2?Math.max(Qe,f.theta):Math.min(Je,f.theta)),f.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,f.phi)),f.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(y,t.dampingFactor):t.target.add(y),t.zoomToCursor&&I||t.object.isOrthographicCamera?f.radius=se(f.radius):f.radius=se(f.radius*p),g.setFromSpherical(f),g.applyQuaternion(le),gn.copy(t.target).add(g),t.object.matrixAutoUpdate||t.object.updateMatrix(),t.object.lookAt(t.target),t.enableDamping===!0?(h.theta*=1-t.dampingFactor,h.phi*=1-t.dampingFactor,y.multiplyScalar(1-t.dampingFactor)):(h.set(0,0,0),y.set(0,0,0));let bt=!1;if(t.zoomToCursor&&I){let _t=null;if(t.object instanceof Gt&&t.object.isPerspectiveCamera){const Mt=g.length();_t=se(Mt*p);const Ut=Mt-_t;t.object.position.addScaledVector(P,Ut),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const Mt=new J(L.x,L.y,0);Mt.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/p)),t.object.updateProjectionMatrix(),bt=!0;const Ut=new J(L.x,L.y,0);Ut.unproject(t.object),t.object.position.sub(Ut).add(Mt),t.object.updateMatrixWorld(),_t=g.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;_t!==null&&(t.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(_t).add(t.object.position):(wn.origin.copy(t.object.position),wn.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(wn.direction))<Vi?e.lookAt(t.target):(hr.setFromNormalAndCoplanarPoint(t.object.up,t.target),wn.intersectPlane(hr,t.target))))}else t.object instanceof At&&t.object.isOrthographicCamera&&(bt=p!==1,bt&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/p)),t.object.updateProjectionMatrix()));return p=1,I=!1,bt||k.distanceToSquared(t.object.position)>u||8*(1-Pe.dot(t.object.quaternion))>u?(t.dispatchEvent(r),k.copy(t.object.position),Pe.copy(t.object.quaternion),bt=!1,!0):!1}})(),this.connect=g=>{t.domElement=g,t.domElement.style.touchAction="none",t.domElement.addEventListener("contextmenu",mn),t.domElement.addEventListener("pointerdown",Pt),t.domElement.addEventListener("pointercancel",at),t.domElement.addEventListener("wheel",We)},this.dispose=()=>{var g,N,W,le,k,Pe;t.domElement&&(t.domElement.style.touchAction="auto"),(g=t.domElement)==null||g.removeEventListener("contextmenu",mn),(N=t.domElement)==null||N.removeEventListener("pointerdown",Pt),(W=t.domElement)==null||W.removeEventListener("pointercancel",at),(le=t.domElement)==null||le.removeEventListener("wheel",We),(k=t.domElement)==null||k.ownerDocument.removeEventListener("pointermove",ft),(Pe=t.domElement)==null||Pe.ownerDocument.removeEventListener("pointerup",at),t._domElementKeyEvents!==null&&t._domElementKeyEvents.removeEventListener("keydown",Dt)};const t=this,r={type:"change"},i={type:"start"},s={type:"end"},c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=c.NONE;const u=1e-6,f=new sr,h=new sr;let p=1;const y=new J,M=new Fe,b=new Fe,T=new Fe,x=new Fe,_=new Fe,F=new Fe,O=new Fe,A=new Fe,w=new Fe,P=new J,L=new Fe;let I=!1;const C=[],Z={};function Q(){return 2*Math.PI/60/60*t.autoRotateSpeed}function V(){return Math.pow(.95,t.zoomSpeed)}function G(g){t.reverseOrbit||t.reverseHorizontalOrbit?h.theta+=g:h.theta-=g}function X(g){t.reverseOrbit||t.reverseVerticalOrbit?h.phi+=g:h.phi-=g}const q=(()=>{const g=new J;return function(W,le){g.setFromMatrixColumn(le,0),g.multiplyScalar(-W),y.add(g)}})(),ae=(()=>{const g=new J;return function(W,le){t.screenSpacePanning===!0?g.setFromMatrixColumn(le,1):(g.setFromMatrixColumn(le,0),g.crossVectors(t.object.up,g)),g.multiplyScalar(W),y.add(g)}})(),xe=(()=>{const g=new J;return function(W,le){const k=t.domElement;if(k&&t.object instanceof Gt&&t.object.isPerspectiveCamera){const Pe=t.object.position;g.copy(Pe).sub(t.target);let nt=g.length();nt*=Math.tan(t.object.fov/2*Math.PI/180),q(2*W*nt/k.clientHeight,t.object.matrix),ae(2*le*nt/k.clientHeight,t.object.matrix)}else k&&t.object instanceof At&&t.object.isOrthographicCamera?(q(W*(t.object.right-t.object.left)/t.object.zoom/k.clientWidth,t.object.matrix),ae(le*(t.object.top-t.object.bottom)/t.object.zoom/k.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}})();function he(g){t.object instanceof Gt&&t.object.isPerspectiveCamera||t.object instanceof At&&t.object.isOrthographicCamera?p=g:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function te(g){he(p/g)}function ue(g){he(p*g)}function re(g){if(!t.zoomToCursor||!t.domElement)return;I=!0;const N=t.domElement.getBoundingClientRect(),W=g.clientX-N.left,le=g.clientY-N.top,k=N.width,Pe=N.height;L.x=W/k*2-1,L.y=-(le/Pe)*2+1,P.set(L.x,L.y,1).unproject(t.object).sub(t.object.position).normalize()}function se(g){return Math.max(t.minDistance,Math.min(t.maxDistance,g))}function Me(g){M.set(g.clientX,g.clientY)}function Ne(g){re(g),O.set(g.clientX,g.clientY)}function ce(g){x.set(g.clientX,g.clientY)}function Ue(g){b.set(g.clientX,g.clientY),T.subVectors(b,M).multiplyScalar(t.rotateSpeed);const N=t.domElement;N&&(G(2*Math.PI*T.x/N.clientHeight),X(2*Math.PI*T.y/N.clientHeight)),M.copy(b),t.update()}function Se(g){A.set(g.clientX,g.clientY),w.subVectors(A,O),w.y>0?te(V()):w.y<0&&ue(V()),O.copy(A),t.update()}function Ct(g){_.set(g.clientX,g.clientY),F.subVectors(_,x).multiplyScalar(t.panSpeed),xe(F.x,F.y),x.copy(_),t.update()}function Ie(g){re(g),g.deltaY<0?ue(V()):g.deltaY>0&&te(V()),t.update()}function de(g){let N=!1;switch(g.code){case t.keys.UP:xe(0,t.keyPanSpeed),N=!0;break;case t.keys.BOTTOM:xe(0,-t.keyPanSpeed),N=!0;break;case t.keys.LEFT:xe(t.keyPanSpeed,0),N=!0;break;case t.keys.RIGHT:xe(-t.keyPanSpeed,0),N=!0;break}N&&(g.preventDefault(),t.update())}function ze(){if(C.length==1)M.set(C[0].pageX,C[0].pageY);else{const g=.5*(C[0].pageX+C[1].pageX),N=.5*(C[0].pageY+C[1].pageY);M.set(g,N)}}function Oe(){if(C.length==1)x.set(C[0].pageX,C[0].pageY);else{const g=.5*(C[0].pageX+C[1].pageX),N=.5*(C[0].pageY+C[1].pageY);x.set(g,N)}}function qe(){const g=C[0].pageX-C[1].pageX,N=C[0].pageY-C[1].pageY,W=Math.sqrt(g*g+N*N);O.set(0,W)}function it(){t.enableZoom&&qe(),t.enablePan&&Oe()}function Yt(){t.enableZoom&&qe(),t.enableRotate&&ze()}function Ge(g){if(C.length==1)b.set(g.pageX,g.pageY);else{const W=Ft(g),le=.5*(g.pageX+W.x),k=.5*(g.pageY+W.y);b.set(le,k)}T.subVectors(b,M).multiplyScalar(t.rotateSpeed);const N=t.domElement;N&&(G(2*Math.PI*T.x/N.clientHeight),X(2*Math.PI*T.y/N.clientHeight)),M.copy(b)}function Et(g){if(C.length==1)_.set(g.pageX,g.pageY);else{const N=Ft(g),W=.5*(g.pageX+N.x),le=.5*(g.pageY+N.y);_.set(W,le)}F.subVectors(_,x).multiplyScalar(t.panSpeed),xe(F.x,F.y),x.copy(_)}function ht(g){const N=Ft(g),W=g.pageX-N.x,le=g.pageY-N.y,k=Math.sqrt(W*W+le*le);A.set(0,k),w.set(0,Math.pow(A.y/O.y,t.zoomSpeed)),te(w.y),O.copy(A)}function Ot(g){t.enableZoom&&ht(g),t.enablePan&&Et(g)}function $t(g){t.enableZoom&&ht(g),t.enableRotate&&Ge(g)}function Pt(g){var N,W;t.enabled!==!1&&(C.length===0&&((N=t.domElement)==null||N.ownerDocument.addEventListener("pointermove",ft),(W=t.domElement)==null||W.ownerDocument.addEventListener("pointerup",at)),Mn(g),g.pointerType==="touch"?Nt(g):Tt(g))}function ft(g){t.enabled!==!1&&(g.pointerType==="touch"?_n(g):qt(g))}function at(g){var N,W,le;xt(g),C.length===0&&((N=t.domElement)==null||N.releasePointerCapture(g.pointerId),(W=t.domElement)==null||W.ownerDocument.removeEventListener("pointermove",ft),(le=t.domElement)==null||le.ownerDocument.removeEventListener("pointerup",at)),t.dispatchEvent(s),l=c.NONE}function Tt(g){let N;switch(g.button){case 0:N=t.mouseButtons.LEFT;break;case 1:N=t.mouseButtons.MIDDLE;break;case 2:N=t.mouseButtons.RIGHT;break;default:N=-1}switch(N){case kt.DOLLY:if(t.enableZoom===!1)return;Ne(g),l=c.DOLLY;break;case kt.ROTATE:if(g.ctrlKey||g.metaKey||g.shiftKey){if(t.enablePan===!1)return;ce(g),l=c.PAN}else{if(t.enableRotate===!1)return;Me(g),l=c.ROTATE}break;case kt.PAN:if(g.ctrlKey||g.metaKey||g.shiftKey){if(t.enableRotate===!1)return;Me(g),l=c.ROTATE}else{if(t.enablePan===!1)return;ce(g),l=c.PAN}break;default:l=c.NONE}l!==c.NONE&&t.dispatchEvent(i)}function qt(g){if(t.enabled!==!1)switch(l){case c.ROTATE:if(t.enableRotate===!1)return;Ue(g);break;case c.DOLLY:if(t.enableZoom===!1)return;Se(g);break;case c.PAN:if(t.enablePan===!1)return;Ct(g);break}}function We(g){t.enabled===!1||t.enableZoom===!1||l!==c.NONE&&l!==c.ROTATE||(g.preventDefault(),t.dispatchEvent(i),Ie(g),t.dispatchEvent(s))}function Dt(g){t.enabled===!1||t.enablePan===!1||de(g)}function Nt(g){switch(Le(g),C.length){case 1:switch(t.touches.ONE){case Ht.ROTATE:if(t.enableRotate===!1)return;ze(),l=c.TOUCH_ROTATE;break;case Ht.PAN:if(t.enablePan===!1)return;Oe(),l=c.TOUCH_PAN;break;default:l=c.NONE}break;case 2:switch(t.touches.TWO){case Ht.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;it(),l=c.TOUCH_DOLLY_PAN;break;case Ht.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Yt(),l=c.TOUCH_DOLLY_ROTATE;break;default:l=c.NONE}break;default:l=c.NONE}l!==c.NONE&&t.dispatchEvent(i)}function _n(g){switch(Le(g),l){case c.TOUCH_ROTATE:if(t.enableRotate===!1)return;Ge(g),t.update();break;case c.TOUCH_PAN:if(t.enablePan===!1)return;Et(g),t.update();break;case c.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;Ot(g),t.update();break;case c.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;$t(g),t.update();break;default:l=c.NONE}}function mn(g){t.enabled!==!1&&g.preventDefault()}function Mn(g){C.push(g)}function xt(g){delete Z[g.pointerId];for(let N=0;N<C.length;N++)if(C[N].pointerId==g.pointerId){C.splice(N,1);return}}function Le(g){let N=Z[g.pointerId];N===void 0&&(N=new Fe,Z[g.pointerId]=N),N.set(g.pageX,g.pageY)}function Ft(g){const N=g.pointerId===C[0].pointerId?C[1]:C[0];return Z[N.pointerId]}this.dollyIn=(g=V())=>{ue(g),t.update()},this.dollyOut=(g=V())=>{te(g),t.update()},this.getScale=()=>p,this.setScale=g=>{he(g),t.update()},this.getZoomScale=()=>V(),n!==void 0&&this.connect(n),this.update()}};const Yi={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},$i={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};class qi extends Tr{constructor(e){super(e),this.type=He}parse(e){const s=function(L,I){switch(L){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(I||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(I||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(I||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(I||""))}},h=function(L,I,C){I=I||1024;let Q=L.pos,V=-1,G=0,X="",q=String.fromCharCode.apply(null,new Uint16Array(L.subarray(Q,Q+128)));for(;0>(V=q.indexOf(`
`))&&G<I&&Q<L.byteLength;)X+=q,G+=q.length,Q+=128,q+=String.fromCharCode.apply(null,new Uint16Array(L.subarray(Q,Q+128)));return-1<V?(L.pos+=G+V+1,X+q.slice(0,V)):!1},p=function(L){const I=/^#\?(\S+)/,C=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Q=/^\s*FORMAT=(\S+)\s*$/,V=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,G={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let X,q;for((L.pos>=L.byteLength||!(X=h(L)))&&s(1,"no header found"),(q=X.match(I))||s(3,"bad initial token"),G.valid|=1,G.programtype=q[1],G.string+=X+`
`;X=h(L),X!==!1;){if(G.string+=X+`
`,X.charAt(0)==="#"){G.comments+=X+`
`;continue}if((q=X.match(C))&&(G.gamma=parseFloat(q[1])),(q=X.match(Z))&&(G.exposure=parseFloat(q[1])),(q=X.match(Q))&&(G.valid|=2,G.format=q[1]),(q=X.match(V))&&(G.valid|=4,G.height=parseInt(q[1],10),G.width=parseInt(q[2],10)),G.valid&2&&G.valid&4)break}return G.valid&2||s(3,"missing format specifier"),G.valid&4||s(3,"missing image size specifier"),G},y=function(L,I,C){const Z=I;if(Z<8||Z>32767||L[0]!==2||L[1]!==2||L[2]&128)return new Uint8Array(L);Z!==(L[2]<<8|L[3])&&s(3,"wrong scanline width");const Q=new Uint8Array(4*I*C);Q.length||s(4,"unable to allocate buffer space");let V=0,G=0;const X=4*Z,q=new Uint8Array(4),ae=new Uint8Array(X);let xe=C;for(;xe>0&&G<L.byteLength;){G+4>L.byteLength&&s(1),q[0]=L[G++],q[1]=L[G++],q[2]=L[G++],q[3]=L[G++],(q[0]!=2||q[1]!=2||(q[2]<<8|q[3])!=Z)&&s(3,"bad rgbe scanline format");let he=0,te;for(;he<X&&G<L.byteLength;){te=L[G++];const re=te>128;if(re&&(te-=128),(te===0||he+te>X)&&s(3,"bad scanline data"),re){const se=L[G++];for(let Me=0;Me<te;Me++)ae[he++]=se}else ae.set(L.subarray(G,G+te),he),he+=te,G+=te}const ue=Z;for(let re=0;re<ue;re++){let se=0;Q[V]=ae[re+se],se+=Z,Q[V+1]=ae[re+se],se+=Z,Q[V+2]=ae[re+se],se+=Z,Q[V+3]=ae[re+se],V+=4}xe--}return Q},M=function(L,I,C,Z){const Q=L[I+3],V=Math.pow(2,Q-128)/255;C[Z+0]=L[I+0]*V,C[Z+1]=L[I+1]*V,C[Z+2]=L[I+2]*V,C[Z+3]=1},b=function(L,I,C,Z){const Q=L[I+3],V=Math.pow(2,Q-128)/255;C[Z+0]=jt.toHalfFloat(Math.min(L[I+0]*V,65504)),C[Z+1]=jt.toHalfFloat(Math.min(L[I+1]*V,65504)),C[Z+2]=jt.toHalfFloat(Math.min(L[I+2]*V,65504)),C[Z+3]=jt.toHalfFloat(1)},T=new Uint8Array(e);T.pos=0;const x=p(T),_=x.width,F=x.height,O=y(T.subarray(T.pos),_,F);let A,w,P;switch(this.type){case ut:P=O.length/4;const L=new Float32Array(P*4);for(let C=0;C<P;C++)M(O,C*4,L,C*4);A=L,w=ut;break;case He:P=O.length/4;const I=new Uint16Array(P*4);for(let C=0;C<P;C++)b(O,C*4,I,C*4);A=I,w=He;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:_,height:F,data:A,header:x.string,gamma:x.gamma,exposure:x.exposure,type:w}}setDataType(e){return this.type=e,this}load(e,n,t,r){function i(s,c){switch(s.type){case ut:case He:"colorSpace"in s?s.colorSpace="srgb-linear":s.encoding=3e3,s.minFilter=Be,s.magFilter=Be,s.generateMipmaps=!1,s.flipY=!0;break}n&&n(s,c)}return super.load(e,i,t,r)}}const tn=Er>=152;class Qi extends Tr{constructor(e){super(e),this.type=He}parse(e){const I=Math.pow(2.7182818,2.2);function C(a,d){for(var m=0,E=0;E<65536;++E)(E==0||a[E>>3]&1<<(E&7))&&(d[m++]=E);for(var R=m-1;m<65536;)d[m++]=0;return R}function Z(a){for(var d=0;d<16384;d++)a[d]={},a[d].len=0,a[d].lit=0,a[d].p=null}const Q={l:0,c:0,lc:0};function V(a,d,m,E,R){for(;m<a;)d=d<<8|Ft(E,R),m+=8;m-=a,Q.l=d>>m&(1<<a)-1,Q.c=d,Q.lc=m}const G=new Array(59);function X(a){for(var d=0;d<=58;++d)G[d]=0;for(var d=0;d<65537;++d)G[a[d]]+=1;for(var m=0,d=58;d>0;--d){var E=m+G[d]>>1;G[d]=m,m=E}for(var d=0;d<65537;++d){var R=a[d];R>0&&(a[d]=R|G[R]++<<6)}}function q(a,d,m,E,R,S,U){for(var D=m,j=0,B=0;R<=S;R++){if(D.value-m.value>E)return!1;V(6,j,B,a,D);var z=Q.l;if(j=Q.c,B=Q.lc,U[R]=z,z==63){if(D.value-m.value>E)throw"Something wrong with hufUnpackEncTable";V(8,j,B,a,D);var H=Q.l+6;if(j=Q.c,B=Q.lc,R+H>S+1)throw"Something wrong with hufUnpackEncTable";for(;H--;)U[R++]=0;R--}else if(z>=59){var H=z-59+2;if(R+H>S+1)throw"Something wrong with hufUnpackEncTable";for(;H--;)U[R++]=0;R--}}X(U)}function ae(a){return a&63}function xe(a){return a>>6}function he(a,d,m,E){for(;d<=m;d++){var R=xe(a[d]),S=ae(a[d]);if(R>>S)throw"Invalid table entry";if(S>14){var U=E[R>>S-14];if(U.len)throw"Invalid table entry";if(U.lit++,U.p){var D=U.p;U.p=new Array(U.lit);for(var j=0;j<U.lit-1;++j)U.p[j]=D[j]}else U.p=new Array(1);U.p[U.lit-1]=d}else if(S)for(var B=0,j=1<<14-S;j>0;j--){var U=E[(R<<14-S)+B];if(U.len||U.p)throw"Invalid table entry";U.len=S,U.lit=d,B++}}return!0}const te={c:0,lc:0};function ue(a,d,m,E){a=a<<8|Ft(m,E),d+=8,te.c=a,te.lc=d}const re={c:0,lc:0};function se(a,d,m,E,R,S,U,D,j,B){if(a==d){E<8&&(ue(m,E,R,U),m=te.c,E=te.lc),E-=8;var z=m>>E,z=new Uint8Array([z])[0];if(j.value+z>B)return!1;for(var H=D[j.value-1];z-- >0;)D[j.value++]=H}else if(j.value<B)D[j.value++]=a;else return!1;re.c=m,re.lc=E}function Me(a){return a&65535}function Ne(a){var d=Me(a);return d>32767?d-65536:d}const ce={a:0,b:0};function Ue(a,d){var m=Ne(a),E=Ne(d),R=E,S=m+(R&1)+(R>>1),U=S,D=S-R;ce.a=U,ce.b=D}function Se(a,d){var m=Me(a),E=Me(d),R=m-(E>>1)&65535,S=E+R-32768&65535;ce.a=S,ce.b=R}function Ct(a,d,m,E,R,S,U){for(var D=U<16384,j=m>R?R:m,B=1,z;B<=j;)B<<=1;for(B>>=1,z=B,B>>=1;B>=1;){for(var H=0,_e=H+S*(R-z),K=S*B,Y=S*z,ee=E*B,ne=E*z,pe,ge,Re,De;H<=_e;H+=Y){for(var ve=H,rt=H+E*(m-z);ve<=rt;ve+=ne){var we=ve+ee,Ae=ve+K,ot=Ae+ee;D?(Ue(a[ve+d],a[Ae+d]),pe=ce.a,Re=ce.b,Ue(a[we+d],a[ot+d]),ge=ce.a,De=ce.b,Ue(pe,ge),a[ve+d]=ce.a,a[we+d]=ce.b,Ue(Re,De),a[Ae+d]=ce.a,a[ot+d]=ce.b):(Se(a[ve+d],a[Ae+d]),pe=ce.a,Re=ce.b,Se(a[we+d],a[ot+d]),ge=ce.a,De=ce.b,Se(pe,ge),a[ve+d]=ce.a,a[we+d]=ce.b,Se(Re,De),a[Ae+d]=ce.a,a[ot+d]=ce.b)}if(m&B){var Ae=ve+K;D?Ue(a[ve+d],a[Ae+d]):Se(a[ve+d],a[Ae+d]),pe=ce.a,a[Ae+d]=ce.b,a[ve+d]=pe}}if(R&B)for(var ve=H,rt=H+E*(m-z);ve<=rt;ve+=ne){var we=ve+ee;D?Ue(a[ve+d],a[we+d]):Se(a[ve+d],a[we+d]),pe=ce.a,a[we+d]=ce.b,a[ve+d]=pe}z=B,B>>=1}return H}function Ie(a,d,m,E,R,S,U,D,j,B){for(var z=0,H=0,_e=D,K=Math.trunc(R.value+(S+7)/8);R.value<K;)for(ue(z,H,m,R),z=te.c,H=te.lc;H>=14;){var Y=z>>H-14&16383,ee=d[Y];if(ee.len)H-=ee.len,se(ee.lit,U,z,H,m,E,R,j,B,_e),z=re.c,H=re.lc;else{if(!ee.p)throw"hufDecode issues";var ne;for(ne=0;ne<ee.lit;ne++){for(var pe=ae(a[ee.p[ne]]);H<pe&&R.value<K;)ue(z,H,m,R),z=te.c,H=te.lc;if(H>=pe&&xe(a[ee.p[ne]])==(z>>H-pe&(1<<pe)-1)){H-=pe,se(ee.p[ne],U,z,H,m,E,R,j,B,_e),z=re.c,H=re.lc;break}}if(ne==ee.lit)throw"hufDecode issues"}}var ge=8-S&7;for(z>>=ge,H-=ge;H>0;){var ee=d[z<<14-H&16383];if(ee.len)H-=ee.len,se(ee.lit,U,z,H,m,E,R,j,B,_e),z=re.c,H=re.lc;else throw"hufDecode issues"}return!0}function de(a,d,m,E,R,S){var U={value:0},D=m.value,j=Le(d,m),B=Le(d,m);m.value+=4;var z=Le(d,m);if(m.value+=4,j<0||j>=65537||B<0||B>=65537)throw"Something wrong with HUF_ENCSIZE";var H=new Array(65537),_e=new Array(16384);Z(_e);var K=E-(m.value-D);if(q(a,d,m,K,j,B,H),z>8*(E-(m.value-D)))throw"Something wrong with hufUncompress";he(H,j,B,_e),Ie(H,_e,a,d,m,z,B,S,R,U)}function ze(a,d,m){for(var E=0;E<m;++E)d[E]=a[d[E]]}function Oe(a){for(var d=1;d<a.length;d++){var m=a[d-1]+a[d]-128;a[d]=m}}function qe(a,d){for(var m=0,E=Math.floor((a.length+1)/2),R=0,S=a.length-1;!(R>S||(d[R++]=a[m++],R>S));)d[R++]=a[E++]}function it(a){for(var d=a.byteLength,m=new Array,E=0,R=new DataView(a);d>0;){var S=R.getInt8(E++);if(S<0){var U=-S;d-=U+1;for(var D=0;D<U;D++)m.push(R.getUint8(E++))}else{var U=S;d-=2;for(var j=R.getUint8(E++),D=0;D<U+1;D++)m.push(j)}}return m}function Yt(a,d,m,E,R,S){var we=new DataView(S.buffer),U=m[a.idx[0]].width,D=m[a.idx[0]].height,j=3,B=Math.floor(U/8),z=Math.ceil(U/8),H=Math.ceil(D/8),_e=U-(z-1)*8,K=D-(H-1)*8,Y={value:0},ee=new Array(j),ne=new Array(j),pe=new Array(j),ge=new Array(j),Re=new Array(j);for(let me=0;me<j;++me)Re[me]=d[a.idx[me]],ee[me]=me<1?0:ee[me-1]+z*H,ne[me]=new Float32Array(64),pe[me]=new Uint16Array(64),ge[me]=new Uint16Array(z*64);for(let me=0;me<H;++me){var De=8;me==H-1&&(De=K);var ve=8;for(let be=0;be<z;++be){be==z-1&&(ve=_e);for(let fe=0;fe<j;++fe)pe[fe].fill(0),pe[fe][0]=R[ee[fe]++],Ge(Y,E,pe[fe]),Et(pe[fe],ne[fe]),ht(ne[fe]);Ot(ne);for(let fe=0;fe<j;++fe)$t(ne[fe],ge[fe],be*64)}let Ce=0;for(let be=0;be<j;++be){const fe=m[a.idx[be]].type;for(let Ke=8*me;Ke<8*me+De;++Ke){Ce=Re[be][Ke];for(let Rt=0;Rt<B;++Rt){const ke=Rt*64+(Ke&7)*8;we.setUint16(Ce+0*fe,ge[be][ke+0],!0),we.setUint16(Ce+2*fe,ge[be][ke+1],!0),we.setUint16(Ce+4*fe,ge[be][ke+2],!0),we.setUint16(Ce+6*fe,ge[be][ke+3],!0),we.setUint16(Ce+8*fe,ge[be][ke+4],!0),we.setUint16(Ce+10*fe,ge[be][ke+5],!0),we.setUint16(Ce+12*fe,ge[be][ke+6],!0),we.setUint16(Ce+14*fe,ge[be][ke+7],!0),Ce+=16*fe}}if(B!=z)for(let Ke=8*me;Ke<8*me+De;++Ke){const Rt=Re[be][Ke]+8*B*2*fe,ke=B*64+(Ke&7)*8;for(let pt=0;pt<ve;++pt)we.setUint16(Rt+pt*2*fe,ge[be][ke+pt],!0)}}}for(var rt=new Uint16Array(U),we=new DataView(S.buffer),Ae=0;Ae<j;++Ae){m[a.idx[Ae]].decoded=!0;var ot=m[a.idx[Ae]].type;if(m[Ae].type==2)for(var en=0;en<D;++en){const me=Re[Ae][en];for(var Ze=0;Ze<U;++Ze)rt[Ze]=we.getUint16(me+Ze*2*ot,!0);for(var Ze=0;Ze<U;++Ze)we.setFloat32(me+Ze*2*ot,k(rt[Ze]),!0)}}}function Ge(a,d,m){for(var E,R=1;R<64;)E=d[a.value],E==65280?R=64:E>>8==255?R+=E&255:(m[R]=E,R++),a.value++}function Et(a,d){d[0]=k(a[0]),d[1]=k(a[1]),d[2]=k(a[5]),d[3]=k(a[6]),d[4]=k(a[14]),d[5]=k(a[15]),d[6]=k(a[27]),d[7]=k(a[28]),d[8]=k(a[2]),d[9]=k(a[4]),d[10]=k(a[7]),d[11]=k(a[13]),d[12]=k(a[16]),d[13]=k(a[26]),d[14]=k(a[29]),d[15]=k(a[42]),d[16]=k(a[3]),d[17]=k(a[8]),d[18]=k(a[12]),d[19]=k(a[17]),d[20]=k(a[25]),d[21]=k(a[30]),d[22]=k(a[41]),d[23]=k(a[43]),d[24]=k(a[9]),d[25]=k(a[11]),d[26]=k(a[18]),d[27]=k(a[24]),d[28]=k(a[31]),d[29]=k(a[40]),d[30]=k(a[44]),d[31]=k(a[53]),d[32]=k(a[10]),d[33]=k(a[19]),d[34]=k(a[23]),d[35]=k(a[32]),d[36]=k(a[39]),d[37]=k(a[45]),d[38]=k(a[52]),d[39]=k(a[54]),d[40]=k(a[20]),d[41]=k(a[22]),d[42]=k(a[33]),d[43]=k(a[38]),d[44]=k(a[46]),d[45]=k(a[51]),d[46]=k(a[55]),d[47]=k(a[60]),d[48]=k(a[21]),d[49]=k(a[34]),d[50]=k(a[37]),d[51]=k(a[47]),d[52]=k(a[50]),d[53]=k(a[56]),d[54]=k(a[59]),d[55]=k(a[61]),d[56]=k(a[35]),d[57]=k(a[36]),d[58]=k(a[48]),d[59]=k(a[49]),d[60]=k(a[57]),d[61]=k(a[58]),d[62]=k(a[62]),d[63]=k(a[63])}function ht(a){const d=.5*Math.cos(.7853975),m=.5*Math.cos(3.14159/16),E=.5*Math.cos(3.14159/8),R=.5*Math.cos(3*3.14159/16),S=.5*Math.cos(5*3.14159/16),U=.5*Math.cos(3*3.14159/8),D=.5*Math.cos(7*3.14159/16);for(var j=new Array(4),B=new Array(4),z=new Array(4),H=new Array(4),_e=0;_e<8;++_e){var K=_e*8;j[0]=E*a[K+2],j[1]=U*a[K+2],j[2]=E*a[K+6],j[3]=U*a[K+6],B[0]=m*a[K+1]+R*a[K+3]+S*a[K+5]+D*a[K+7],B[1]=R*a[K+1]-D*a[K+3]-m*a[K+5]-S*a[K+7],B[2]=S*a[K+1]-m*a[K+3]+D*a[K+5]+R*a[K+7],B[3]=D*a[K+1]-S*a[K+3]+R*a[K+5]-m*a[K+7],z[0]=d*(a[K+0]+a[K+4]),z[3]=d*(a[K+0]-a[K+4]),z[1]=j[0]+j[3],z[2]=j[1]-j[2],H[0]=z[0]+z[1],H[1]=z[3]+z[2],H[2]=z[3]-z[2],H[3]=z[0]-z[1],a[K+0]=H[0]+B[0],a[K+1]=H[1]+B[1],a[K+2]=H[2]+B[2],a[K+3]=H[3]+B[3],a[K+4]=H[3]-B[3],a[K+5]=H[2]-B[2],a[K+6]=H[1]-B[1],a[K+7]=H[0]-B[0]}for(var Y=0;Y<8;++Y)j[0]=E*a[16+Y],j[1]=U*a[16+Y],j[2]=E*a[48+Y],j[3]=U*a[48+Y],B[0]=m*a[8+Y]+R*a[24+Y]+S*a[40+Y]+D*a[56+Y],B[1]=R*a[8+Y]-D*a[24+Y]-m*a[40+Y]-S*a[56+Y],B[2]=S*a[8+Y]-m*a[24+Y]+D*a[40+Y]+R*a[56+Y],B[3]=D*a[8+Y]-S*a[24+Y]+R*a[40+Y]-m*a[56+Y],z[0]=d*(a[Y]+a[32+Y]),z[3]=d*(a[Y]-a[32+Y]),z[1]=j[0]+j[3],z[2]=j[1]-j[2],H[0]=z[0]+z[1],H[1]=z[3]+z[2],H[2]=z[3]-z[2],H[3]=z[0]-z[1],a[0+Y]=H[0]+B[0],a[8+Y]=H[1]+B[1],a[16+Y]=H[2]+B[2],a[24+Y]=H[3]+B[3],a[32+Y]=H[3]-B[3],a[40+Y]=H[2]-B[2],a[48+Y]=H[1]-B[1],a[56+Y]=H[0]-B[0]}function Ot(a){for(var d=0;d<64;++d){var m=a[0][d],E=a[1][d],R=a[2][d];a[0][d]=m+1.5747*R,a[1][d]=m-.1873*E-.4682*R,a[2][d]=m+1.8556*E}}function $t(a,d,m){for(var E=0;E<64;++E)d[m+E]=jt.toHalfFloat(Pt(a[E]))}function Pt(a){return a<=1?Math.sign(a)*Math.pow(Math.abs(a),2.2):Math.sign(a)*Math.pow(I,Math.abs(a)-1)}function ft(a){return new DataView(a.array.buffer,a.offset.value,a.size)}function at(a){var d=a.viewer.buffer.slice(a.offset.value,a.offset.value+a.size),m=new Uint8Array(it(d)),E=new Uint8Array(m.length);return Oe(m),qe(m,E),new DataView(E.buffer)}function Tt(a){var d=a.array.slice(a.offset.value,a.offset.value+a.size),m=yn(d),E=new Uint8Array(m.length);return Oe(m),qe(m,E),new DataView(E.buffer)}function qt(a){for(var d=a.viewer,m={value:a.offset.value},E=new Uint16Array(a.width*a.scanlineBlockSize*(a.channels*a.type)),R=new Uint8Array(8192),S=0,U=new Array(a.channels),D=0;D<a.channels;D++)U[D]={},U[D].start=S,U[D].end=U[D].start,U[D].nx=a.width,U[D].ny=a.lines,U[D].size=a.type,S+=U[D].nx*U[D].ny*U[D].size;var j=Pe(d,m),B=Pe(d,m);if(B>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(j<=B)for(var D=0;D<B-j+1;D++)R[D+j]=g(d,m);var z=new Uint16Array(65536),H=C(R,z),_e=Le(d,m);de(a.array,d,m,_e,E,S);for(var D=0;D<a.channels;++D)for(var K=U[D],Y=0;Y<U[D].size;++Y)Ct(E,K.start+Y,K.nx,K.size,K.ny,K.nx*K.size,H);ze(z,E,S);for(var ee=0,ne=new Uint8Array(E.buffer.byteLength),pe=0;pe<a.lines;pe++)for(var ge=0;ge<a.channels;ge++){var K=U[ge],Re=K.nx*K.size,De=new Uint8Array(E.buffer,K.end*2,Re*2);ne.set(De,ee),ee+=Re*2,K.end+=Re}return new DataView(ne.buffer)}function We(a){var d=a.array.slice(a.offset.value,a.offset.value+a.size),m=yn(d);const E=a.lines*a.channels*a.width,R=a.type==1?new Uint16Array(E):new Uint32Array(E);let S=0,U=0;const D=new Array(4);for(let j=0;j<a.lines;j++)for(let B=0;B<a.channels;B++){let z=0;switch(a.type){case 1:D[0]=S,D[1]=D[0]+a.width,S=D[1]+a.width;for(let H=0;H<a.width;++H){const _e=m[D[0]++]<<8|m[D[1]++];z+=_e,R[U]=z,U++}break;case 2:D[0]=S,D[1]=D[0]+a.width,D[2]=D[1]+a.width,S=D[2]+a.width;for(let H=0;H<a.width;++H){const _e=m[D[0]++]<<24|m[D[1]++]<<16|m[D[2]++]<<8;z+=_e,R[U]=z,U++}break}}return new DataView(R.buffer)}function Dt(a){var d=a.viewer,m={value:a.offset.value},E=new Uint8Array(a.width*a.lines*(a.channels*a.type*2)),R={version:N(d,m),unknownUncompressedSize:N(d,m),unknownCompressedSize:N(d,m),acCompressedSize:N(d,m),dcCompressedSize:N(d,m),rleCompressedSize:N(d,m),rleUncompressedSize:N(d,m),rleRawSize:N(d,m),totalAcUncompressedCount:N(d,m),totalDcUncompressedCount:N(d,m),acCompression:N(d,m)};if(R.version<2)throw"EXRLoader.parse: "+Jt.compression+" version "+R.version+" is unsupported";for(var S=new Array,U=Pe(d,m)-2;U>0;){var D=Nt(d.buffer,m),j=g(d,m),B=j>>2&3,z=(j>>4)-1,H=new Int8Array([z])[0],_e=g(d,m);S.push({name:D,index:H,type:_e,compression:B}),U-=D.length+3}for(var K=Jt.channels,Y=new Array(a.channels),ee=0;ee<a.channels;++ee){var ne=Y[ee]={},pe=K[ee];ne.name=pe.name,ne.compression=0,ne.decoded=!1,ne.type=pe.pixelType,ne.pLinear=pe.pLinear,ne.width=a.width,ne.height=a.lines}for(var ge={idx:new Array(3)},Re=0;Re<a.channels;++Re)for(var ne=Y[Re],ee=0;ee<S.length;++ee){var De=S[ee];ne.name==De.name&&(ne.compression=De.compression,De.index>=0&&(ge.idx[De.index]=Re),ne.offset=Re)}if(R.acCompressedSize>0)switch(R.acCompression){case 0:var we=new Uint16Array(R.totalAcUncompressedCount);de(a.array,d,m,R.acCompressedSize,we,R.totalAcUncompressedCount);break;case 1:var ve=a.array.slice(m.value,m.value+R.totalAcUncompressedCount),rt=yn(ve),we=new Uint16Array(rt.buffer);m.value+=R.totalAcUncompressedCount;break}if(R.dcCompressedSize>0){var Ae={array:a.array,offset:m,size:R.dcCompressedSize},ot=new Uint16Array(Tt(Ae).buffer);m.value+=R.dcCompressedSize}if(R.rleRawSize>0){var ve=a.array.slice(m.value,m.value+R.rleCompressedSize),rt=yn(ve),en=it(rt.buffer);m.value+=R.rleCompressedSize}for(var Ze=0,me=new Array(Y.length),ee=0;ee<me.length;++ee)me[ee]=new Array;for(var Ce=0;Ce<a.lines;++Ce)for(var be=0;be<Y.length;++be)me[be].push(Ze),Ze+=Y[be].width*a.type*2;Yt(ge,me,Y,we,ot,E);for(var ee=0;ee<Y.length;++ee){var ne=Y[ee];if(!ne.decoded)switch(ne.compression){case 2:for(var fe=0,Ke=0,Ce=0;Ce<a.lines;++Ce){for(var Rt=me[ee][fe],ke=0;ke<ne.width;++ke){for(var pt=0;pt<2*ne.type;++pt)E[Rt++]=en[Ke+pt*ne.width*ne.height];Ke++}fe++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(E.buffer)}function Nt(a,d){for(var m=new Uint8Array(a),E=0;m[d.value+E]!=0;)E+=1;var R=new TextDecoder().decode(m.slice(d.value,d.value+E));return d.value=d.value+E+1,R}function _n(a,d,m){var E=new TextDecoder().decode(new Uint8Array(a).slice(d.value,d.value+m));return d.value=d.value+m,E}function mn(a,d){var m=xt(a,d),E=Le(a,d);return[m,E]}function Mn(a,d){var m=Le(a,d),E=Le(a,d);return[m,E]}function xt(a,d){var m=a.getInt32(d.value,!0);return d.value=d.value+4,m}function Le(a,d){var m=a.getUint32(d.value,!0);return d.value=d.value+4,m}function Ft(a,d){var m=a[d.value];return d.value=d.value+1,m}function g(a,d){var m=a.getUint8(d.value);return d.value=d.value+1,m}const N=function(a,d){let m;return"getBigInt64"in DataView.prototype?m=Number(a.getBigInt64(d.value,!0)):m=a.getUint32(d.value+4,!0)+Number(a.getUint32(d.value,!0)<<32),d.value+=8,m};function W(a,d){var m=a.getFloat32(d.value,!0);return d.value+=4,m}function le(a,d){return jt.toHalfFloat(W(a,d))}function k(a){var d=(a&31744)>>10,m=a&1023;return(a>>15?-1:1)*(d?d===31?m?NaN:1/0:Math.pow(2,d-15)*(1+m/1024):6103515625e-14*(m/1024))}function Pe(a,d){var m=a.getUint16(d.value,!0);return d.value+=2,m}function nt(a,d){return k(Pe(a,d))}function nr(a,d,m,E){for(var R=m.value,S=[];m.value<R+E-1;){var U=Nt(d,m),D=xt(a,m),j=g(a,m);m.value+=3;var B=xt(a,m),z=xt(a,m);S.push({name:U,pixelType:D,pLinear:j,xSampling:B,ySampling:z})}return m.value+=1,S}function gn(a,d){var m=W(a,d),E=W(a,d),R=W(a,d),S=W(a,d),U=W(a,d),D=W(a,d),j=W(a,d),B=W(a,d);return{redX:m,redY:E,greenX:R,greenY:S,blueX:U,blueY:D,whiteX:j,whiteY:B}}function Qe(a,d){var m=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],E=g(a,d);return m[E]}function Je(a,d){var m=Le(a,d),E=Le(a,d),R=Le(a,d),S=Le(a,d);return{xMin:m,yMin:E,xMax:R,yMax:S}}function bt(a,d){var m=["INCREASING_Y"],E=g(a,d);return m[E]}function _t(a,d){var m=W(a,d),E=W(a,d);return[m,E]}function Mt(a,d){var m=W(a,d),E=W(a,d),R=W(a,d);return[m,E,R]}function Ut(a,d,m,E,R){if(E==="string"||E==="stringvector"||E==="iccProfile")return _n(d,m,R);if(E==="chlist")return nr(a,d,m,R);if(E==="chromaticities")return gn(a,m);if(E==="compression")return Qe(a,m);if(E==="box2i")return Je(a,m);if(E==="lineOrder")return bt(a,m);if(E==="float")return W(a,m);if(E==="v2f")return _t(a,m);if(E==="v3f")return Mt(a,m);if(E==="int")return xt(a,m);if(E==="rational")return mn(a,m);if(E==="timecode")return Mn(a,m);if(E==="preview")return m.value+=R,"skipped";m.value+=R}function qr(a,d,m){const E={};if(a.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";E.version=a.getUint8(4);const R=a.getUint8(5);E.spec={singleTile:!!(R&2),longName:!!(R&4),deepFormat:!!(R&8),multiPart:!!(R&16)},m.value=8;for(var S=!0;S;){var U=Nt(d,m);if(U==0)S=!1;else{var D=Nt(d,m),j=Le(a,m),B=Ut(a,d,m,D,j);B===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${D}'.`):E[U]=B}}if((R&-5)!=0)throw console.error("EXRHeader:",E),"THREE.EXRLoader: provided file is currently unsupported.";return E}function Qr(a,d,m,E,R){const S={size:0,viewer:d,array:m,offset:E,width:a.dataWindow.xMax-a.dataWindow.xMin+1,height:a.dataWindow.yMax-a.dataWindow.yMin+1,channels:a.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:a.channels[0].pixelType,uncompress:null,getter:null,format:null,[tn?"colorSpace":"encoding"]:null};switch(a.compression){case"NO_COMPRESSION":S.lines=1,S.uncompress=ft;break;case"RLE_COMPRESSION":S.lines=1,S.uncompress=at;break;case"ZIPS_COMPRESSION":S.lines=1,S.uncompress=Tt;break;case"ZIP_COMPRESSION":S.lines=16,S.uncompress=Tt;break;case"PIZ_COMPRESSION":S.lines=32,S.uncompress=qt;break;case"PXR24_COMPRESSION":S.lines=16,S.uncompress=We;break;case"DWAA_COMPRESSION":S.lines=32,S.uncompress=Dt;break;case"DWAB_COMPRESSION":S.lines=256,S.uncompress=Dt;break;default:throw"EXRLoader.parse: "+a.compression+" is unsupported"}if(S.scanlineBlockSize=S.lines,S.type==1)switch(R){case ut:S.getter=nt,S.inputSize=2;break;case He:S.getter=Pe,S.inputSize=2;break}else if(S.type==2)switch(R){case ut:S.getter=W,S.inputSize=4;break;case He:S.getter=le,S.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+S.type+" for "+a.compression+".";S.blockCount=(a.dataWindow.yMax+1)/S.scanlineBlockSize;for(var U=0;U<S.blockCount;U++)N(d,E);S.outputChannels=S.channels==3?4:S.channels;const D=S.width*S.height*S.outputChannels;switch(R){case ut:S.byteArray=new Float32Array(D),S.channels<S.outputChannels&&S.byteArray.fill(1,0,D);break;case He:S.byteArray=new Uint16Array(D),S.channels<S.outputChannels&&S.byteArray.fill(15360,0,D);break;default:console.error("THREE.EXRLoader: unsupported type: ",R);break}return S.bytesPerLine=S.width*S.inputSize*S.channels,S.outputChannels==4?S.format=ln:S.format=gs,tn?S.colorSpace="srgb-linear":S.encoding=3e3,S}const vn=new DataView(e),Jr=new Uint8Array(e),Qt={value:0},Jt=qr(vn,e,Qt),oe=Qr(Jt,vn,Jr,Qt,this.type),rr={value:0},es={R:0,G:1,B:2,A:3,Y:0};for(let a=0;a<oe.height/oe.scanlineBlockSize;a++){const d=Le(vn,Qt);oe.size=Le(vn,Qt),oe.lines=d+oe.scanlineBlockSize>oe.height?oe.height-d:oe.scanlineBlockSize;const E=oe.size<oe.lines*oe.bytesPerLine?oe.uncompress(oe):ft(oe);Qt.value+=oe.size;for(let R=0;R<oe.scanlineBlockSize;R++){const S=R+a*oe.scanlineBlockSize;if(S>=oe.height)break;for(let U=0;U<oe.channels;U++){const D=es[Jt.channels[U].name];for(let j=0;j<oe.width;j++){rr.value=(R*(oe.channels*oe.width)+U*oe.width+j)*oe.inputSize;const B=(oe.height-1-S)*(oe.width*oe.outputChannels)+j*oe.outputChannels+D;oe.byteArray[B]=oe.getter(E,rr)}}}}return{header:Jt,width:oe.width,height:oe.height,data:oe.byteArray,format:oe.format,[tn?"colorSpace":"encoding"]:oe[tn?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,n,t,r){function i(s,c){tn?s.colorSpace=c.colorSpace:s.encoding=c.encoding,s.minFilter=Be,s.magFilter=Be,s.generateMipmaps=!1,s.flipY=!1,n&&n(s,c)}return super.load(e,i,t,r)}}function Hr(o,e,n,t){var r;return r=class extends Kt{constructor(i){super({vertexShader:e,fragmentShader:n,...i});for(const s in o)this.uniforms[s]=new vs(o[s]),Object.defineProperty(this,s,{get(){return this.uniforms[s].value},set(c){this.uniforms[s].value=c}});this.uniforms=ys.clone(this.uniforms)}},r.key=sn.generateUUID(),r}const Ji=()=>parseInt(ws.replace(/\D+/g,"")),Br=Ji(),ea=v.forwardRef(({makeDefault:o,camera:e,regress:n,domElement:t,enableDamping:r=!0,keyEvents:i=!1,onChange:s,onStart:c,onEnd:l,...u},f)=>{const h=Ee(w=>w.invalidate),p=Ee(w=>w.camera),y=Ee(w=>w.gl),M=Ee(w=>w.events),b=Ee(w=>w.setEvents),T=Ee(w=>w.set),x=Ee(w=>w.get),_=Ee(w=>w.performance),F=e||p,O=t||M.connected||y.domElement,A=v.useMemo(()=>new Xi(F),[F]);return Xt(()=>{A.enabled&&A.update()},-1),v.useEffect(()=>(i&&A.connect(i===!0?O:i),A.connect(O),()=>void A.dispose()),[i,O,n,A,h]),v.useEffect(()=>{const w=I=>{h(),n&&_.regress(),s&&s(I)},P=I=>{c&&c(I)},L=I=>{l&&l(I)};return A.addEventListener("change",w),A.addEventListener("start",P),A.addEventListener("end",L),()=>{A.removeEventListener("start",P),A.removeEventListener("end",L),A.removeEventListener("change",w)}},[s,c,l,A,h,b]),v.useEffect(()=>{if(o){const w=x().controls;return T({controls:A}),()=>T({controls:w})}},[o,A]),v.createElement("primitive",$e({ref:f,object:A,enableDamping:r},u))}),ta=v.forwardRef(function({children:e,object:n,disable:t,disableX:r,disableY:i,disableZ:s,left:c,right:l,top:u,bottom:f,front:h,back:p,onCentered:y,precise:M=!0,cacheKey:b=0,...T},x){const _=v.useRef(null),F=v.useRef(null),O=v.useRef(null),[A]=v.useState(()=>new Zn),[w]=v.useState(()=>new J),[P]=v.useState(()=>new xr);return v.useLayoutEffect(()=>{F.current.matrixWorld.identity(),A.setFromObject(n??O.current,M);const L=A.max.x-A.min.x,I=A.max.y-A.min.y,C=A.max.z-A.min.z;A.getCenter(w),A.getBoundingSphere(P);const Z=u?I/2:f?-I/2:0,Q=c?-L/2:l?L/2:0,V=h?C/2:p?-C/2:0;F.current.position.set(t||r?0:-w.x+Q,t||i?0:-w.y+Z,t||s?0:-w.z+V),y?.({parent:_.current.parent,container:_.current,width:L,height:I,depth:C,boundingBox:A,boundingSphere:P,center:w,verticalAlignment:Z,horizontalAlignment:Q,depthAlignment:V})},[b,y,u,c,h,t,r,i,s,n,M,l,f,p,A,w,P]),v.useImperativeHandle(x,()=>_.current,[]),v.createElement("group",$e({ref:_},T),v.createElement("group",{ref:F},v.createElement("group",{ref:O},e)))}),na=Hr({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");var Ve=function(o){return o[o.NONE=0]="NONE",o[o.START=1]="START",o[o.ACTIVE=2]="ACTIVE",o}(Ve||{});const Bt=o=>o&&o.isOrthographicCamera,ra=o=>o&&o.isBox3,sa=o=>1-Math.exp(-5*o)+.007*o,jr=v.createContext(null);function ia({children:o,maxDuration:e=1,margin:n=1.2,observe:t,fit:r,clip:i,interpolateFunc:s=sa,onFit:c}){const l=v.useRef(null),{camera:u,size:f,invalidate:h}=Ee(),p=Ee(A=>A.controls),y=v.useRef(c);y.current=c;const M=v.useRef({camPos:new J,camRot:new It,camZoom:1}),b=v.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),T=v.useRef(Ve.NONE),x=v.useRef(0),[_]=v.useState(()=>new Zn),F=v.useMemo(()=>{function A(){const w=_.getSize(new J),P=_.getCenter(new J),L=Math.max(w.x,w.y,w.z),I=Bt(u)?L*4:L/(2*Math.atan(Math.PI*u.fov/360)),C=Bt(u)?L*4:I/u.aspect,Z=n*Math.max(I,C);return{box:_,size:w,center:P,distance:Z}}return{getSize:A,refresh(w){if(ra(w))_.copy(w);else{const P=w||l.current;if(!P)return this;P.updateWorldMatrix(!0,!0),_.setFromObject(P)}if(_.isEmpty()){const P=u.position.length()||10;_.setFromCenterAndSize(new J,new J(P,P,P))}return M.current.camPos.copy(u.position),M.current.camRot.copy(u.quaternion),Bt(u)&&(M.current.camZoom=u.zoom),b.current.camPos=void 0,b.current.camRot=void 0,b.current.camZoom=void 0,b.current.camUp=void 0,b.current.target=void 0,this},reset(){const{center:w,distance:P}=A(),L=u.position.clone().sub(w).normalize();b.current.camPos=w.clone().addScaledVector(L,P),b.current.target=w.clone();const I=new Lt().lookAt(b.current.camPos,b.current.target,u.up);return b.current.camRot=new It().setFromRotationMatrix(I),T.current=Ve.START,x.current=0,this},moveTo(w){return b.current.camPos=Array.isArray(w)?new J(...w):w.clone(),T.current=Ve.START,x.current=0,this},lookAt({target:w,up:P}){b.current.target=Array.isArray(w)?new J(...w):w.clone(),P?b.current.camUp=Array.isArray(P)?new J(...P):P.clone():b.current.camUp=u.up.clone();const L=new Lt().lookAt(b.current.camPos||u.position,b.current.target,b.current.camUp);return b.current.camRot=new It().setFromRotationMatrix(L),T.current=Ve.START,x.current=0,this},to({position:w,target:P}){return this.moveTo(w).lookAt({target:P})},fit(){if(!Bt(u))return this.reset();let w=0,P=0;const L=[new J(_.min.x,_.min.y,_.min.z),new J(_.min.x,_.max.y,_.min.z),new J(_.min.x,_.min.y,_.max.z),new J(_.min.x,_.max.y,_.max.z),new J(_.max.x,_.max.y,_.max.z),new J(_.max.x,_.max.y,_.min.z),new J(_.max.x,_.min.y,_.max.z),new J(_.max.x,_.min.y,_.min.z)],I=b.current.camPos||u.position,C=b.current.target||p?.target,Z=b.current.camUp||u.up,Q=C?new Lt().lookAt(I,C,Z).setPosition(I).invert():u.matrixWorldInverse;for(const X of L)X.applyMatrix4(Q),w=Math.max(w,Math.abs(X.y)),P=Math.max(P,Math.abs(X.x));w*=2,P*=2;const V=(u.top-u.bottom)/w,G=(u.right-u.left)/P;return b.current.camZoom=Math.min(V,G)/n,T.current=Ve.START,x.current=0,y.current&&y.current(this.getSize()),this},clip(){const{distance:w}=A();return u.near=w/100,u.far=w*100,u.updateProjectionMatrix(),p&&(p.maxDistance=w*10,p.update()),h(),this}}},[_,u,p,n,h]);v.useLayoutEffect(()=>{if(p){const A=()=>{if(p&&b.current.target&&T.current!==Ve.NONE){const w=new J().setFromMatrixColumn(u.matrix,2),P=M.current.camPos.distanceTo(p.target),L=(b.current.camPos||M.current.camPos).distanceTo(b.current.target),I=(1-x.current)*P+x.current*L;p.target.copy(u.position).addScaledVector(w,-I),p.update()}T.current=Ve.NONE};return p.addEventListener("start",A),()=>p.removeEventListener("start",A)}},[p]);const O=v.useRef(0);return v.useLayoutEffect(()=>{(t||O.current++===0)&&(F.refresh(),r&&F.reset().fit(),i&&F.clip())},[f,i,r,t,u,p]),Xt((A,w)=>{if(T.current===Ve.START)T.current=Ve.ACTIVE,h();else if(T.current===Ve.ACTIVE){if(x.current+=w/e,x.current>=1)b.current.camPos&&u.position.copy(b.current.camPos),b.current.camRot&&u.quaternion.copy(b.current.camRot),b.current.camUp&&u.up.copy(b.current.camUp),b.current.camZoom&&Bt(u)&&(u.zoom=b.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix(),p&&b.current.target&&(p.target.copy(b.current.target),p.update()),T.current=Ve.NONE;else{const P=s(x.current);b.current.camPos&&u.position.lerpVectors(M.current.camPos,b.current.camPos,P),b.current.camRot&&u.quaternion.slerpQuaternions(M.current.camRot,b.current.camRot,P),b.current.camUp&&u.up.set(0,1,0).applyQuaternion(u.quaternion),b.current.camZoom&&Bt(u)&&(u.zoom=(1-P)*M.current.camZoom+P*b.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix()}h()}}),v.createElement("group",{ref:l},v.createElement(jr.Provider,{value:F},o))}function aa(){return v.useContext(jr)}const zr=(o,e,n)=>{let t;switch(o){case Dn:t=new Uint8ClampedArray(e*n*4);break;case He:t=new Uint16Array(e*n*4);break;case Ms:t=new Uint32Array(e*n*4);break;case _s:t=new Int8Array(e*n*4);break;case bs:t=new Int16Array(e*n*4);break;case xs:t=new Int32Array(e*n*4);break;case ut:t=new Float32Array(e*n*4);break;default:throw new Error("Unsupported data type")}return t};let En;const oa=(o,e,n,t)=>{if(En!==void 0)return En;const r=new Vt(1,1,t);e.setRenderTarget(r);const i=new hn(new Kn,new zt({color:16777215}));e.render(i,n),e.setRenderTarget(null);const s=zr(o,r.width,r.height);return e.readRenderTargetPixels(r,0,0,r.width,r.height,s),r.dispose(),i.geometry.dispose(),i.material.dispose(),En=s[0]!==0,En};class Yn{constructor(e){var n,t,r,i,s,c,l,u,f,h,p,y,M,b,T,x;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(F){throw this._renderer.setRenderTarget(null),F}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const _={format:ln,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=e.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy)!==void 0?(t=e.renderTargetOptions)===null||t===void 0?void 0:t.anisotropy:1,generateMipmaps:((r=e.renderTargetOptions)===null||r===void 0?void 0:r.generateMipmaps)!==void 0?(i=e.renderTargetOptions)===null||i===void 0?void 0:i.generateMipmaps:!1,magFilter:((s=e.renderTargetOptions)===null||s===void 0?void 0:s.magFilter)!==void 0?(c=e.renderTargetOptions)===null||c===void 0?void 0:c.magFilter:Be,minFilter:((l=e.renderTargetOptions)===null||l===void 0?void 0:l.minFilter)!==void 0?(u=e.renderTargetOptions)===null||u===void 0?void 0:u.minFilter:Be,samples:((f=e.renderTargetOptions)===null||f===void 0?void 0:f.samples)!==void 0?(h=e.renderTargetOptions)===null||h===void 0?void 0:h.samples:void 0,wrapS:((p=e.renderTargetOptions)===null||p===void 0?void 0:p.wrapS)!==void 0?(y=e.renderTargetOptions)===null||y===void 0?void 0:y.wrapS:lt,wrapT:((M=e.renderTargetOptions)===null||M===void 0?void 0:M.wrapT)!==void 0?(b=e.renderTargetOptions)===null||b===void 0?void 0:b.wrapT:lt};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=Yn.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new br,this._camera=new At,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!oa(this._type,this._renderer,this._camera,_)){let F;switch(this._type){case He:F=this._renderer.extensions.has("EXT_color_buffer_float")?ut:void 0;break}F!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${ut}`),this._type=F):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new hn(new Kn,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Vt(this.width,this.height,_),this._renderTarget.texture.mapping=((T=e.renderTargetOptions)===null||T===void 0?void 0:T.mapping)!==void 0?(x=e.renderTargetOptions)===null||x===void 0?void 0:x.mapping:Tn}static instantiateRenderer(){const e=new Es;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=zr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const n=new Ts(this.toArray(),this.width,this.height,ln,this._type,e?.mapping||Tn,e?.wrapS||lt,e?.wrapT||lt,e?.magFilter||Be,e?.minFilter||Be,e?.anisotropy||1,je);return n.generateMipmaps=e?.generateMipmaps!==void 0?e?.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Kt&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof vt&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof vt&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const ca=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,la=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class ua extends Kt{constructor({gamma:e,offsetHdr:n,offsetSdr:t,gainMapMin:r,gainMapMax:i,maxDisplayBoost:s,hdrCapacityMin:c,hdrCapacityMax:l,sdr:u,gainMap:f}){super({name:"GainMapDecoderMaterial",vertexShader:ca,fragmentShader:la,uniforms:{sdr:{value:u},gainMap:{value:f},gamma:{value:new J(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new J().fromArray(n)},offsetSdr:{value:new J().fromArray(t)},gainMapMin:{value:new J().fromArray(r)},gainMapMax:{value:new J().fromArray(i)},weightFactor:{value:(Math.log2(s)-c)/(l-c)}},blending:Ss,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=s,this._hdrCapacityMin=c,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const n=this.uniforms.gamma.value;n.x=1/e[0],n.y=1/e[1],n.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class Gr extends Error{}class Wr extends Error{}const nn=(o,e,n)=>{const t=new RegExp(`${e}="([^"]*)"`,"i").exec(o);if(t)return t[1];const r=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(o);if(r){const i=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return i&&i.length===3?i.map(s=>s.replace(/<\/?rdf:li>/g,"")):r[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${e} in gainmap metadata`)},da=o=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(o):e=o.toString();let n=e.indexOf("<x:xmpmeta");for(;n!==-1;){const t=e.indexOf("x:xmpmeta>",n),r=e.slice(n,t+10);try{const i=nn(r,"hdrgm:GainMapMin","0"),s=nn(r,"hdrgm:GainMapMax"),c=nn(r,"hdrgm:Gamma","1"),l=nn(r,"hdrgm:OffsetSDR","0.015625"),u=nn(r,"hdrgm:OffsetHDR","0.015625"),f=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(r),h=f?f[1]:"0",p=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(r);if(!p)throw new Error("Incomplete gainmap metadata");const y=p[1];return{gainMapMin:Array.isArray(i)?i.map(M=>parseFloat(M)):[parseFloat(i),parseFloat(i),parseFloat(i)],gainMapMax:Array.isArray(s)?s.map(M=>parseFloat(M)):[parseFloat(s),parseFloat(s),parseFloat(s)],gamma:Array.isArray(c)?c.map(M=>parseFloat(M)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetSdr:Array.isArray(l)?l.map(M=>parseFloat(M)):[parseFloat(l),parseFloat(l),parseFloat(l)],offsetHdr:Array.isArray(u)?u.map(M=>parseFloat(M)):[parseFloat(u),parseFloat(u),parseFloat(u)],hdrCapacityMin:parseFloat(h),hdrCapacityMax:parseFloat(y)}}catch{}n=e.indexOf("<x:xmpmeta",t)}};class ha{constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((n,t)=>{const r=this.options.debug,i=new DataView(e.buffer);if(i.getUint16(0)!==65496){t(new Error("Not a valid jpeg"));return}const s=i.byteLength;let c=2,l=0,u;for(;c<s;){if(++l>250){t(new Error(`Found no marker after ${l} loops 😵`));return}if(i.getUint8(c)!==255){t(new Error(`Not a valid marker at offset 0x${c.toString(16)}, found: 0x${i.getUint8(c).toString(16)}`));return}if(u=i.getUint8(c+1),r&&console.log(`Marker: ${u.toString(16)}`),u===226){r&&console.log("Found APP2 marker (0xffe2)");const f=c+4;if(i.getUint32(f)===1297106432){const h=f+4;let p;if(i.getUint16(h)===18761)p=!1;else if(i.getUint16(h)===19789)p=!0;else{t(new Error("No valid endianness marker found in TIFF header"));return}if(i.getUint16(h+2,!p)!==42){t(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const y=i.getUint32(h+4,!p);if(y<8){t(new Error("Not valid TIFF data! (First offset less than 8)"));return}const M=h+y,b=i.getUint16(M,!p),T=M+2;let x=0;for(let A=T;A<T+12*b;A+=12)i.getUint16(A,!p)===45057&&(x=i.getUint32(A+8,!p));const F=M+2+b*12+4,O=[];for(let A=F;A<F+x*16;A+=16){const w={MPType:i.getUint32(A,!p),size:i.getUint32(A+4,!p),dataOffset:i.getUint32(A+8,!p),dependantImages:i.getUint32(A+12,!p),start:-1,end:-1,isFII:!1};w.dataOffset?(w.start=h+w.dataOffset,w.isFII=!1):(w.start=0,w.isFII=!0),w.end=w.start+w.size,O.push(w)}if(this.options.extractNonFII&&O.length){const A=new Blob([i]),w=[];for(const P of O){if(P.isFII&&!this.options.extractFII)continue;const L=A.slice(P.start,P.end+1,"image/jpeg");w.push(L)}n(w)}}}c+=2+i.getUint16(c+2)}})}}const fa=async o=>{const e=da(o);if(!e)throw new Wr("Gain map XMP metadata not found");const t=await new ha({extractFII:!0,extractNonFII:!0}).extract(o);if(t.length!==2)throw new Gr("Gain map recovery image not found");return{sdr:new Uint8Array(await t[0].arrayBuffer()),gainMap:new Uint8Array(await t[1].arrayBuffer()),metadata:e}},pr=o=>new Promise((e,n)=>{const t=document.createElement("img");t.onload=()=>{e(t)},t.onerror=r=>{n(r)},t.src=URL.createObjectURL(o)});class Zr extends Vn{constructor(e,n){super(n),e&&(this._renderer=e),this._internalLoadingManager=new Rs}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new ua({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new vt,sdr:new vt});return new Yn({width:16,height:16,type:He,colorSpace:je,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,n,t,r){const i=r?new Blob([r],{type:"image/jpeg"}):void 0,s=new Blob([t],{type:"image/jpeg"});let c,l,u=!1;if(typeof createImageBitmap>"u"){const p=await Promise.all([i?pr(i):Promise.resolve(void 0),pr(s)]);l=p[0],c=p[1],u=!0}else{const p=await Promise.all([i?createImageBitmap(i,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:"flipY"})]);l=p[0],c=p[1]}const f=new vt(l||new ImageData(2,2),Tn,lt,lt,Be,ir,ln,Dn,1,je);f.flipY=u,f.needsUpdate=!0;const h=new vt(c,Tn,lt,lt,Be,ir,ln,Dn,1,dt);h.flipY=u,h.needsUpdate=!0,e.width=c.width,e.height=c.height,e.material.gainMap=f,e.material.sdr=h,e.material.gainMapMin=n.gainMapMin,e.material.gainMapMax=n.gainMapMax,e.material.offsetHdr=n.offsetHdr,e.material.offsetSdr=n.offsetSdr,e.material.gamma=n.gamma,e.material.hdrCapacityMin=n.hdrCapacityMin,e.material.hdrCapacityMax=n.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class pa extends Zr{load([e,n,t],r,i,s){const c=this.prepareQuadRenderer();let l,u,f;const h=async()=>{if(l&&u&&f){try{await this.render(c,f,l,u)}catch(I){this.manager.itemError(e),this.manager.itemError(n),this.manager.itemError(t),typeof s=="function"&&s(I),c.disposeOnDemandRenderer();return}typeof r=="function"&&r(c),this.manager.itemEnd(e),this.manager.itemEnd(n),this.manager.itemEnd(t),c.disposeOnDemandRenderer()}};let p=!0,y=0,M=0,b=!0,T=0,x=0,_=!0,F=0,O=0;const A=()=>{if(typeof i=="function"){const I=y+T+F,C=M+x+O,Z=p&&b&&_;i(new ProgressEvent("progress",{lengthComputable:Z,loaded:C,total:I}))}};this.manager.itemStart(e),this.manager.itemStart(n),this.manager.itemStart(t);const w=new wt(this._internalLoadingManager);w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(e,async I=>{if(typeof I=="string")throw new Error("Invalid sdr buffer");l=I,await h()},I=>{p=I.lengthComputable,M=I.loaded,y=I.total,A()},I=>{this.manager.itemError(e),typeof s=="function"&&s(I)});const P=new wt(this._internalLoadingManager);P.setResponseType("arraybuffer"),P.setRequestHeader(this.requestHeader),P.setPath(this.path),P.setWithCredentials(this.withCredentials),P.load(n,async I=>{if(typeof I=="string")throw new Error("Invalid gainmap buffer");u=I,await h()},I=>{b=I.lengthComputable,x=I.loaded,T=I.total,A()},I=>{this.manager.itemError(n),typeof s=="function"&&s(I)});const L=new wt(this._internalLoadingManager);return L.setRequestHeader(this.requestHeader),L.setPath(this.path),L.setWithCredentials(this.withCredentials),L.load(t,async I=>{if(typeof I!="string")throw new Error("Invalid metadata string");f=JSON.parse(I),await h()},I=>{_=I.lengthComputable,O=I.loaded,F=I.total,A()},I=>{this.manager.itemError(t),typeof s=="function"&&s(I)}),c}}class ma extends Zr{load(e,n,t,r){const i=this.prepareQuadRenderer(),s=new wt(this._internalLoadingManager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(this.withCredentials),this.manager.itemStart(e),s.load(e,async c=>{if(typeof c=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const l=new Uint8Array(c);let u,f,h;try{const p=await fa(l);u=p.sdr,f=p.gainMap,h=p.metadata}catch(p){if(p instanceof Wr||p instanceof Gr)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),h={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},u=l;else throw p}try{await this.render(i,h,u,f)}catch(p){this.manager.itemError(e),typeof r=="function"&&r(p),i.disposeOnDemandRenderer();return}typeof n=="function"&&n(i),this.manager.itemEnd(e),i.disposeOnDemandRenderer()},t,c=>{this.manager.itemError(e),typeof r=="function"&&r(c)}),i}}const dn={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Kr="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Wt=o=>Array.isArray(o),$n=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function bn({files:o=$n,path:e="",preset:n=void 0,colorSpace:t=void 0,extensions:r}={}){n&&(qn(n),o=dn[n],e=Kr);const i=Wt(o),{extension:s,isCubemap:c}=Qn(o),l=Jn(s);if(!l)throw new Error("useEnvironment: Unrecognized file extension: "+o);const u=Ee(y=>y.gl);v.useLayoutEffect(()=>{if(s!=="webp"&&s!=="jpg"&&s!=="jpeg")return;function y(){un.clear(l,i?[o]:o)}u.domElement.addEventListener("webglcontextlost",y,{once:!0})},[o,u.domElement]);const f=un(l,i?[o]:o,y=>{(s==="webp"||s==="jpg"||s==="jpeg")&&y.setRenderer(u),y.setPath==null||y.setPath(e),r&&r(y)});let h=i?f[0]:f;if(s==="jpg"||s==="jpeg"||s==="webp"){var p;h=(p=h.renderTarget)==null?void 0:p.texture}return h.mapping=c?As:Is,h.colorSpace=t??(c?"srgb":"srgb-linear"),h}const ga={files:$n,path:"",preset:void 0,extensions:void 0};bn.preload=o=>{const e={...ga,...o};let{files:n,path:t=""}=e;const{preset:r,extensions:i}=e;r&&(qn(r),n=dn[r],t=Kr);const{extension:s}=Qn(n);if(s==="webp"||s==="jpg"||s==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const c=Jn(s);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+n);un.preload(c,Wt(n)?[n]:n,l=>{l.setPath==null||l.setPath(t),i&&i(l)})};const va={files:$n,preset:void 0};bn.clear=o=>{const e={...va,...o};let{files:n}=e;const{preset:t}=e;t&&(qn(t),n=dn[t]);const{extension:r}=Qn(n),i=Jn(r);if(!i)throw new Error("useEnvironment: Unrecognized file extension: "+n);un.clear(i,Wt(n)?[n]:n)};function qn(o){if(!(o in dn))throw new Error("Preset must be one of: "+Object.keys(dn).join(", "))}function Qn(o){var e;const n=Wt(o)&&o.length===6,t=Wt(o)&&o.length===3&&o.some(s=>s.endsWith("json")),r=Wt(o)?o[0]:o;return{extension:n?"cube":t?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":(e=r.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:n,isGainmap:t}}function Jn(o){return o==="cube"?Ls:o==="hdr"?qi:o==="exr"?Qi:o==="jpg"||o==="jpeg"?ma:o==="webp"?pa:null}const ya=o=>o.current&&o.current.isScene,wa=o=>ya(o)?o.current:o;function er(o,e,n,t,r={}){var i,s,c,l;r={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const u=wa(e||n),f=u.background,h=u.environment,p={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:(i=(s=u.backgroundRotation)==null||s.clone==null?void 0:s.clone())!==null&&i!==void 0?i:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:(c=(l=u.environmentRotation)==null||l.clone==null?void 0:l.clone())!==null&&c!==void 0?c:[0,0,0]};return o!=="only"&&(u.environment=t),o&&(u.background=t),ar(u,r),()=>{o!=="only"&&(u.environment=h),o&&(u.background=f),ar(u,p)}}function tr({scene:o,background:e=!1,map:n,...t}){const r=Ee(i=>i.scene);return v.useLayoutEffect(()=>{if(n)return er(e,o,r,n,t)}),null}function Vr({background:o=!1,scene:e,blur:n,backgroundBlurriness:t,backgroundIntensity:r,backgroundRotation:i,environmentIntensity:s,environmentRotation:c,...l}){const u=bn(l),f=Ee(h=>h.scene);return v.useLayoutEffect(()=>er(o,e,f,u,{backgroundBlurriness:n??t,backgroundIntensity:r,backgroundRotation:i,environmentIntensity:s,environmentRotation:c})),v.useEffect(()=>()=>{u.dispose()},[u]),null}function Ea({children:o,near:e=.1,far:n=1e3,resolution:t=256,frames:r=1,map:i,background:s=!1,blur:c,backgroundBlurriness:l,backgroundIntensity:u,backgroundRotation:f,environmentIntensity:h,environmentRotation:p,scene:y,files:M,path:b,preset:T=void 0,extensions:x}){const _=Ee(L=>L.gl),F=Ee(L=>L.scene),O=v.useRef(null),[A]=v.useState(()=>new br),w=v.useMemo(()=>{const L=new _r(t);return L.texture.type=He,L},[t]);v.useEffect(()=>()=>{w.dispose()},[w]),v.useLayoutEffect(()=>{if(r===1){const L=_.autoClear;_.autoClear=!0,O.current.update(_,A),_.autoClear=L}return er(s,y,F,w.texture,{backgroundBlurriness:c??l,backgroundIntensity:u,backgroundRotation:f,environmentIntensity:h,environmentRotation:p})},[o,A,w.texture,y,F,s,r,_]);let P=1;return Xt(()=>{if(r===1/0||P<r){const L=_.autoClear;_.autoClear=!0,O.current.update(_,A),_.autoClear=L,P++}}),v.createElement(v.Fragment,null,Cs(v.createElement(v.Fragment,null,o,v.createElement("cubeCamera",{ref:O,args:[e,n,w]}),M||T?v.createElement(Vr,{background:!0,files:M,preset:T,path:b,extensions:x}):i?v.createElement(tr,{background:!0,map:i,extensions:x}):null),A))}function Ta(o){var e,n,t,r;const i=bn(o),s=o.map||i;v.useMemo(()=>Gn({GroundProjectedEnvImpl:Bi}),[]),v.useEffect(()=>()=>{i.dispose()},[i]);const c=v.useMemo(()=>[s],[s]),l=(e=o.ground)==null?void 0:e.height,u=(n=o.ground)==null?void 0:n.radius,f=(t=(r=o.ground)==null?void 0:r.scale)!==null&&t!==void 0?t:1e3;return v.createElement(v.Fragment,null,v.createElement(tr,$e({},o,{map:s})),v.createElement("groundProjectedEnvImpl",{args:c,scale:f,height:l,radius:u}))}function xa(o){return o.ground?v.createElement(Ta,o):o.map?v.createElement(tr,o):o.children?v.createElement(Ea,o):v.createElement(Vr,o)}const ba=v.forwardRef(({scale:o=10,frames:e=1/0,opacity:n=1,width:t=1,height:r=1,blur:i=1,near:s=0,far:c=10,resolution:l=512,smooth:u=!0,color:f="#000000",depthWrite:h=!1,renderOrder:p,...y},M)=>{const b=v.useRef(null),T=Ee(G=>G.scene),x=Ee(G=>G.gl),_=v.useRef(null);t=t*(Array.isArray(o)?o[0]:o||1),r=r*(Array.isArray(o)?o[1]:o||1);const[F,O,A,w,P,L,I]=v.useMemo(()=>{const G=new Vt(l,l),X=new Vt(l,l);X.texture.generateMipmaps=G.texture.generateMipmaps=!1;const q=new Kn(t,r).rotateX(Math.PI/2),ae=new hn(q),xe=new Os;xe.depthTest=xe.depthWrite=!1,xe.onBeforeCompile=ue=>{ue.uniforms={...ue.uniforms,ucolor:{value:new tt(f)}},ue.fragmentShader=ue.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),ue.fragmentShader=ue.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const he=new Kt(Yi),te=new Kt($i);return te.depthTest=he.depthTest=!1,[G,q,xe,ae,he,te,X]},[l,t,r,o,f]),C=G=>{w.visible=!0,w.material=P,P.uniforms.tDiffuse.value=F.texture,P.uniforms.h.value=G*1/256,x.setRenderTarget(I),x.render(w,_.current),w.material=L,L.uniforms.tDiffuse.value=I.texture,L.uniforms.v.value=G*1/256,x.setRenderTarget(F),x.render(w,_.current),w.visible=!1};let Z=0,Q,V;return Xt(()=>{_.current&&(e===1/0||Z<e)&&(Z++,Q=T.background,V=T.overrideMaterial,b.current.visible=!1,T.background=null,T.overrideMaterial=A,x.setRenderTarget(F),x.render(T,_.current),C(i),u&&C(i*.4),x.setRenderTarget(null),b.current.visible=!0,T.overrideMaterial=V,T.background=Q)}),v.useImperativeHandle(M,()=>b.current,[]),v.createElement("group",$e({"rotation-x":Math.PI/2},y,{ref:b}),v.createElement("mesh",{renderOrder:p,geometry:O,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},v.createElement("meshBasicMaterial",{transparent:!0,map:F.texture,opacity:n,depthWrite:h})),v.createElement("orthographicCamera",{ref:_,args:[-t/2,t/2,r/2,-r/2,s,c]}))});function _a(o){return o.isLight}function Ma(o){return!!o.geometry}const Xr=v.createContext(null),Ra=Hr({color:new tt,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${Br>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),Sa=v.forwardRef(({children:o,temporal:e,frames:n=40,limit:t=1/0,blend:r=20,scale:i=10,opacity:s=1,alphaTest:c=.75,color:l="black",colorBlend:u=2,resolution:f=1024,toneMapped:h=!0,...p},y)=>{Gn({SoftShadowMaterial:Ra});const M=Ee(w=>w.gl),b=Ee(w=>w.scene),T=Ee(w=>w.camera),x=Ee(w=>w.invalidate),_=v.useRef(null),F=v.useRef(null),[O]=v.useState(()=>new Ia(M,b,f));v.useLayoutEffect(()=>{O.configure(_.current)},[]);const A=v.useMemo(()=>({lights:new Map,temporal:!!e,frames:Math.max(2,n),blend:Math.max(2,n===1/0?r:n),count:0,getMesh:()=>_.current,reset:()=>{O.clear();const w=_.current.material;w.opacity=0,w.alphaTest=0,A.count=0},update:(w=1)=>{const P=_.current.material;A.temporal?(P.opacity=Math.min(s,P.opacity+s/A.blend),P.alphaTest=Math.min(c,P.alphaTest+c/A.blend)):(P.opacity=s,P.alphaTest=c),F.current.visible=!0,O.prepare();for(let L=0;L<w;L++)A.lights.forEach(I=>I.update()),O.update(T,A.blend);F.current.visible=!1,O.finish()}}),[O,T,b,e,n,r,s,c]);return v.useLayoutEffect(()=>{A.reset(),!A.temporal&&A.frames!==1/0&&A.update(A.blend)}),v.useImperativeHandle(y,()=>A,[A]),Xt(()=>{(A.temporal||A.frames===1/0)&&A.count<A.frames&&A.count<t&&(x(),A.update(),A.count++)}),v.createElement("group",p,v.createElement("group",{traverse:()=>null,ref:F},v.createElement(Xr.Provider,{value:A},o)),v.createElement("mesh",{receiveShadow:!0,ref:_,scale:i,rotation:[-Math.PI/2,0,0]},v.createElement("planeGeometry",null),v.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:h,color:l,blend:u,map:O.progressiveLightMap2.texture})))}),Aa=v.forwardRef(({castShadow:o=!0,bias:e=.001,mapSize:n=512,size:t=5,near:r=.5,far:i=500,frames:s=1,position:c=[0,0,0],radius:l=1,amount:u=8,intensity:f=Br>=155?Math.PI:1,ambient:h=.5,...p},y)=>{const M=v.useRef(null),b=new J(...c).length(),T=v.useContext(Xr),x=v.useCallback(()=>{let F;if(M.current)for(let O=0;O<M.current.children.length;O++)if(F=M.current.children[O],Math.random()>h)F.position.set(c[0]+sn.randFloatSpread(l),c[1]+sn.randFloatSpread(l),c[2]+sn.randFloatSpread(l));else{let A=Math.acos(2*Math.random()-1)-Math.PI/2,w=2*Math.PI*Math.random();F.position.set(Math.cos(A)*Math.cos(w)*b,Math.abs(Math.cos(A)*Math.sin(w)*b),Math.sin(A)*b)}},[l,h,b,...c]),_=v.useMemo(()=>({update:x}),[x]);return v.useImperativeHandle(y,()=>_,[_]),v.useLayoutEffect(()=>{var F;const O=M.current;return T&&((F=T.lights)==null||F.set(O.uuid,_)),()=>{var A;return void(T==null||(A=T.lights)==null?void 0:A.delete(O.uuid))}},[T,_]),v.createElement("group",$e({ref:M},p),Array.from({length:u},(F,O)=>v.createElement("directionalLight",{key:O,castShadow:o,"shadow-bias":e,"shadow-mapSize":[n,n],intensity:f/u},v.createElement("orthographicCamera",{attach:"shadow-camera",args:[-t,t,t,-t,r,i]}))))});class Ia{constructor(e,n,t=1024){this.renderer=e,this.res=t,this.scene=n,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new tt,this.clearAlpha=0;const r={type:He,magFilter:xn,minFilter:xn};this.progressiveLightMap1=new Vt(this.res,this.res,r),this.progressiveLightMap2=new Vt(this.res,this.res,r),this.discardMat=new na,this.targetMat=new Ps({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=i=>{i.vertexShader=`varying vec2 vUv;
`+i.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const s=i.fragmentShader.indexOf("void main() {");i.fragmentShader=`varying vec2 vUv;
`+i.fragmentShader.slice(0,s)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+i.fragmentShader.slice(s-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,i.uniforms.previousShadowMap=this.previousShadowMap,i.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{Ma(e)?this.meshes.push({object:e,material:e.material}):_a(e)&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,n=100){if(!this.object)return;this.averagingWindow.value=n,this.object.material=this.targetMat;const t=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,r=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,i=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(t),this.previousShadowMap.value=r.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=i}}const La={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function Ca({radius:o,adjustCamera:e}){const n=aa();return v.useEffect(()=>{e&&n.refresh().clip().fit()},[o,e]),null}function Oa({children:o,center:e,adjustCamera:n=!0,intensity:t=.5,shadows:r="contact",environment:i="city",preset:s="rembrandt",...c}){var l,u,f,h,p,y,M,b;const T=typeof s=="string"?La[s]:s,[{radius:x,height:_},F]=v.useState({radius:0,width:0,height:0,depth:0}),O=(l=r?.bias)!==null&&l!==void 0?l:-1e-4,A=(u=r?.normalBias)!==null&&u!==void 0?u:0,w=(f=r?.size)!==null&&f!==void 0?f:1024,P=(h=r?.offset)!==null&&h!==void 0?h:0,L=r==="contact"||r?.type==="contact",I=r==="accumulative"||r?.type==="accumulative",C={...typeof r=="object"?r:{}},Z=i?typeof i=="string"?{preset:i}:i:null,Q=v.useCallback(V=>{const{width:G,height:X,depth:q,boundingSphere:ae}=V;F({radius:ae.radius,width:G,height:X,depth:q}),e!=null&&e.onCentered&&e.onCentered(V)},[]);return v.createElement(v.Fragment,null,v.createElement("ambientLight",{intensity:t/3}),v.createElement("spotLight",{penumbra:1,position:[T.main[0]*x,T.main[1]*x,T.main[2]*x],intensity:t*2,castShadow:!!r,"shadow-bias":O,"shadow-normalBias":A,"shadow-mapSize":w}),v.createElement("pointLight",{position:[T.fill[0]*x,T.fill[1]*x,T.fill[2]*x],intensity:t}),v.createElement(ia,$e({fit:!!n,clip:!!n,margin:Number(n),observe:!0},c),v.createElement(Ca,{radius:x,adjustCamera:n}),v.createElement(ta,$e({},e,{position:[0,P/2,0],onCentered:Q}),o)),v.createElement("group",{position:[0,-_/2-P/2,0]},L&&v.createElement(ba,$e({scale:x*4,far:x,blur:2},C)),I&&v.createElement(Sa,$e({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:x*4},C),v.createElement(Aa,{amount:(p=C.amount)!==null&&p!==void 0?p:8,radius:(y=C.radius)!==null&&y!==void 0?y:x,ambient:(M=C.ambient)!==null&&M!==void 0?M:.5,intensity:(b=C.intensity)!==null&&b!==void 0?b:1,position:[T.main[0]*x,T.main[1]*x,T.main[2]*x],size:x*4,bias:-O,mapSize:w}))),i&&v.createElement(xa,Z))}function Pa({all:o,scene:e,camera:n}){const t=Ee(({gl:s})=>s),r=Ee(({camera:s})=>s),i=Ee(({scene:s})=>s);return v.useLayoutEffect(()=>{const s=[];o&&(e||i).traverse(u=>{u.visible===!1&&(s.push(u),u.visible=!0)}),t.compile(e||i,n||r);const c=new _r(128);new Ds(.01,1e5,c).update(t,e||i),c.dispose(),s.forEach(u=>u.visible=!1)},[]),null}function mr(o,e){if(e===Ns)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===Nn||e===Mr){let n=o.getIndex();if(n===null){const s=[],c=o.getAttribute("position");if(c!==void 0){for(let l=0;l<c.count;l++)s.push(l);o.setIndex(s),n=o.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const t=n.count-2,r=[];if(e===Nn)for(let s=1;s<=t;s++)r.push(n.getX(0)),r.push(n.getX(s)),r.push(n.getX(s+1));else for(let s=0;s<t;s++)s%2===0?(r.push(n.getX(s)),r.push(n.getX(s+1)),r.push(n.getX(s+2))):(r.push(n.getX(s+2)),r.push(n.getX(s+1)),r.push(n.getX(s)));r.length/3!==t&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=o.clone();return i.setIndex(r),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}const Ln=new WeakMap;class Da extends Vn{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,t,r){const i=new wt(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,s=>{this.parse(s,n,r)},t,r)}parse(e,n,t=()=>{}){this.decodeDracoFile(e,n,null,null,dt,t).catch(t)}decodeDracoFile(e,n,t,r,i=je,s=()=>{}){const c={attributeIDs:t||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!t,vertexColorSpace:i};return this.decodeGeometry(e,c).then(n).catch(s)}decodeGeometry(e,n){const t=JSON.stringify(n);if(Ln.has(e)){const l=Ln.get(e);if(l.key===t)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const i=this.workerNextTaskID++,s=e.byteLength,c=this._getWorker(i,s).then(l=>(r=l,new Promise((u,f)=>{r._callbacks[i]={resolve:u,reject:f},r.postMessage({type:"decode",id:i,taskConfig:n,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return c.catch(()=>!0).then(()=>{r&&i&&this._releaseTask(r,i)}),Ln.set(e,{key:t,promise:c}),c}_createGeometry(e){const n=new Rr;e.index&&n.setIndex(new an(e.index.array,1));for(let t=0;t<e.attributes.length;t++){const r=e.attributes[t],i=r.name,s=r.array,c=r.itemSize,l=new an(s,c);i==="color"&&(this._assignVertexColorSpace(l,r.vertexColorSpace),l.normalized=!(s instanceof Float32Array)),n.setAttribute(i,l)}return n}_assignVertexColorSpace(e,n){if(n!==dt)return;const t=new tt;for(let r=0,i=e.count;r<i;r++)t.fromBufferAttribute(e,r),Fn.colorSpaceToWorking(t,dt),e.setXYZ(r,t.r,t.g,t.b)}_loadLibrary(e,n){const t=new wt(this.manager);return t.setPath(this.decoderPath),t.setResponseType(n),t.setWithCredentials(this.withCredentials),new Promise((r,i)=>{t.load(e,r,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(t=>{const r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=Na.toString(),s=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(i){const s=i.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,i){return r._taskLoad>i._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskCosts[e]=n,t._taskLoad+=n,t})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Na(){let o,e;onmessage=function(s){const c=s.data;switch(c.type){case"init":o=c.decoderConfig,e=new Promise(function(f){o.onModuleLoaded=function(h){f({draco:h})},DracoDecoderModule(o)});break;case"decode":const l=c.buffer,u=c.taskConfig;e.then(f=>{const h=f.draco,p=new h.Decoder;try{const y=n(h,p,new Int8Array(l),u),M=y.attributes.map(b=>b.array.buffer);y.index&&M.push(y.index.array.buffer),self.postMessage({type:"decode",id:c.id,geometry:y},M)}catch(y){console.error(y),self.postMessage({type:"error",id:c.id,error:y.message})}finally{h.destroy(p)}});break}};function n(s,c,l,u){const f=u.attributeIDs,h=u.attributeTypes;let p,y;const M=c.GetEncodedGeometryType(l);if(M===s.TRIANGULAR_MESH)p=new s.Mesh,y=c.DecodeArrayToMesh(l,l.byteLength,p);else if(M===s.POINT_CLOUD)p=new s.PointCloud,y=c.DecodeArrayToPointCloud(l,l.byteLength,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!y.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+y.error_msg());const b={index:null,attributes:[]};for(const T in f){const x=self[h[T]];let _,F;if(u.useUniqueIDs)F=f[T],_=c.GetAttributeByUniqueId(p,F);else{if(F=c.GetAttributeId(p,s[f[T]]),F===-1)continue;_=c.GetAttribute(p,F)}const O=r(s,c,p,T,x,_);T==="color"&&(O.vertexColorSpace=u.vertexColorSpace),b.attributes.push(O)}return M===s.TRIANGULAR_MESH&&(b.index=t(s,c,p)),s.destroy(p),b}function t(s,c,l){const f=l.num_faces()*3,h=f*4,p=s._malloc(h);c.GetTrianglesUInt32Array(l,h,p);const y=new Uint32Array(s.HEAPF32.buffer,p,f).slice();return s._free(p),{array:y,itemSize:1}}function r(s,c,l,u,f,h){const p=h.num_components(),M=l.num_points()*p,b=M*f.BYTES_PER_ELEMENT,T=i(s,f),x=s._malloc(b);c.GetAttributeDataArrayForAllPoints(l,h,T,b,x);const _=new f(s.HEAPF32.buffer,x,M).slice();return s._free(x),{name:u,array:_,itemSize:p}}function i(s,c){switch(c){case Float32Array:return s.DT_FLOAT32;case Int8Array:return s.DT_INT8;case Int16Array:return s.DT_INT16;case Int32Array:return s.DT_INT32;case Uint8Array:return s.DT_UINT8;case Uint16Array:return s.DT_UINT16;case Uint32Array:return s.DT_UINT32}}}class Fa extends Vn{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new ja(n)}),this.register(function(n){return new za(n)}),this.register(function(n){return new qa(n)}),this.register(function(n){return new Qa(n)}),this.register(function(n){return new Ja(n)}),this.register(function(n){return new Wa(n)}),this.register(function(n){return new Za(n)}),this.register(function(n){return new Ka(n)}),this.register(function(n){return new Va(n)}),this.register(function(n){return new Ba(n)}),this.register(function(n){return new Xa(n)}),this.register(function(n){return new Ga(n)}),this.register(function(n){return new $a(n)}),this.register(function(n){return new Ya(n)}),this.register(function(n){return new ka(n)}),this.register(function(n){return new eo(n)}),this.register(function(n){return new to(n)})}load(e,n,t,r){const i=this;let s;if(this.resourcePath!=="")s=this.resourcePath;else if(this.path!==""){const u=on.extractUrlBase(e);s=on.resolveURL(u,this.path)}else s=on.extractUrlBase(e);this.manager.itemStart(e);const c=function(u){r?r(u):console.error(u),i.manager.itemError(e),i.manager.itemEnd(e)},l=new wt(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{i.parse(u,s,function(f){n(f),i.manager.itemEnd(e)},c)}catch(f){c(f)}},t,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,t,r){let i;const s={},c={},l=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Yr){try{s[ie.KHR_BINARY_GLTF]=new no(e)}catch(h){r&&r(h);return}i=JSON.parse(s[ie.KHR_BINARY_GLTF].content)}else i=JSON.parse(l.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new go(i,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const h=this.pluginCallbacks[f](u);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),c[h.name]=h,s[h.name]=!0}if(i.extensionsUsed)for(let f=0;f<i.extensionsUsed.length;++f){const h=i.extensionsUsed[f],p=i.extensionsRequired||[];switch(h){case ie.KHR_MATERIALS_UNLIT:s[h]=new Ha;break;case ie.KHR_DRACO_MESH_COMPRESSION:s[h]=new ro(i,this.dracoLoader);break;case ie.KHR_TEXTURE_TRANSFORM:s[h]=new so;break;case ie.KHR_MESH_QUANTIZATION:s[h]=new io;break;default:p.indexOf(h)>=0&&c[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}u.setExtensions(s),u.setPlugins(c),u.parse(t,r)}parseAsync(e,n){const t=this;return new Promise(function(r,i){t.parse(e,n,r,i)})}}function Ua(){let o={};return{get:function(e){return o[e]},add:function(e,n){o[e]=n},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const ie={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ka{constructor(e){this.parser=e,this.name=ie.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let t=0,r=n.length;t<r;t++){const i=n[t];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const n=this.parser,t="light:"+e;let r=n.cache.get(t);if(r)return r;const i=n.json,l=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let u;const f=new tt(16777215);l.color!==void 0&&f.setRGB(l.color[0],l.color[1],l.color[2],je);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":u=new ks(f),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Us(f),u.distance=h;break;case"spot":u=new Fs(f),u.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,u.angle=l.spot.outerConeAngle,u.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return u.position.set(0,0,0),ct(u,l),l.intensity!==void 0&&(u.intensity=l.intensity),u.name=n.createUniqueName(l.name||"light_"+e),r=Promise.resolve(u),n.cache.add(t,r),r}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,t=this.parser,i=t.json.nodes[e],c=(i.extensions&&i.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(l){return t._getNodeRef(n.cache,c,l)})}}class Ha{constructor(){this.name=ie.KHR_MATERIALS_UNLIT}getMaterialType(){return zt}extendParams(e,n,t){const r=[];e.color=new tt(1,1,1),e.opacity=1;const i=n.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const s=i.baseColorFactor;e.color.setRGB(s[0],s[1],s[2],je),e.opacity=s[3]}i.baseColorTexture!==void 0&&r.push(t.assignTexture(e,"map",i.baseColorTexture,dt))}return Promise.all(r)}}class Ba{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name].emissiveStrength;return i!==void 0&&(n.emissiveIntensity=i),Promise.resolve()}}class ja{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:st}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];if(s.clearcoatFactor!==void 0&&(n.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&i.push(t.assignTexture(n,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&i.push(t.assignTexture(n,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(i.push(t.assignTexture(n,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const c=s.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new Fe(c,c)}return Promise.all(i)}}class za{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:st}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return n.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class Ga{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:st}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return s.iridescenceFactor!==void 0&&(n.iridescence=s.iridescenceFactor),s.iridescenceTexture!==void 0&&i.push(t.assignTexture(n,"iridescenceMap",s.iridescenceTexture)),s.iridescenceIor!==void 0&&(n.iridescenceIOR=s.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),s.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),s.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),s.iridescenceThicknessTexture!==void 0&&i.push(t.assignTexture(n,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}}class Wa{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:st}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];n.sheenColor=new tt(0,0,0),n.sheenRoughness=0,n.sheen=1;const s=r.extensions[this.name];if(s.sheenColorFactor!==void 0){const c=s.sheenColorFactor;n.sheenColor.setRGB(c[0],c[1],c[2],je)}return s.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=s.sheenRoughnessFactor),s.sheenColorTexture!==void 0&&i.push(t.assignTexture(n,"sheenColorMap",s.sheenColorTexture,dt)),s.sheenRoughnessTexture!==void 0&&i.push(t.assignTexture(n,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(i)}}class Za{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:st}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return s.transmissionFactor!==void 0&&(n.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&i.push(t.assignTexture(n,"transmissionMap",s.transmissionTexture)),Promise.all(i)}}class Ka{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:st}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];n.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&i.push(t.assignTexture(n,"thicknessMap",s.thicknessTexture)),n.attenuationDistance=s.attenuationDistance||1/0;const c=s.attenuationColor||[1,1,1];return n.attenuationColor=new tt().setRGB(c[0],c[1],c[2],je),Promise.all(i)}}class Va{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:st}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return n.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Xa{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:st}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];n.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&i.push(t.assignTexture(n,"specularIntensityMap",s.specularTexture));const c=s.specularColorFactor||[1,1,1];return n.specularColor=new tt().setRGB(c[0],c[1],c[2],je),s.specularColorTexture!==void 0&&i.push(t.assignTexture(n,"specularColorMap",s.specularColorTexture,dt)),Promise.all(i)}}class Ya{constructor(e){this.parser=e,this.name=ie.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:st}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return n.bumpScale=s.bumpFactor!==void 0?s.bumpFactor:1,s.bumpTexture!==void 0&&i.push(t.assignTexture(n,"bumpMap",s.bumpTexture)),Promise.all(i)}}class $a{constructor(e){this.parser=e,this.name=ie.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:st}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],s=r.extensions[this.name];return s.anisotropyStrength!==void 0&&(n.anisotropy=s.anisotropyStrength),s.anisotropyRotation!==void 0&&(n.anisotropyRotation=s.anisotropyRotation),s.anisotropyTexture!==void 0&&i.push(t.assignTexture(n,"anisotropyMap",s.anisotropyTexture)),Promise.all(i)}}class qa{constructor(e){this.parser=e,this.name=ie.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,t=n.json,r=t.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],s=n.options.ktx2Loader;if(!s){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,i.source,s)}}class Qa{constructor(e){this.parser=e,this.name=ie.EXT_TEXTURE_WEBP}loadTexture(e){const n=this.name,t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[n])return null;const s=i.extensions[n],c=r.images[s.source];let l=t.textureLoader;if(c.uri){const u=t.options.manager.getHandler(c.uri);u!==null&&(l=u)}return t.loadTextureImage(e,s.source,l)}}class Ja{constructor(e){this.parser=e,this.name=ie.EXT_TEXTURE_AVIF}loadTexture(e){const n=this.name,t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[n])return null;const s=i.extensions[n],c=r.images[s.source];let l=t.textureLoader;if(c.uri){const u=t.options.manager.getHandler(c.uri);u!==null&&(l=u)}return t.loadTextureImage(e,s.source,l)}}class eo{constructor(e){this.name=ie.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,t=n.bufferViews[e];if(t.extensions&&t.extensions[this.name]){const r=t.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(c){const l=r.byteOffset||0,u=r.byteLength||0,f=r.count,h=r.byteStride,p=new Uint8Array(c,l,u);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(f,h,p,r.mode,r.filter).then(function(y){return y.buffer}):s.ready.then(function(){const y=new ArrayBuffer(f*h);return s.decodeGltfBuffer(new Uint8Array(y),f,h,p,r.mode,r.filter),y})})}else return null}}class to{constructor(e){this.name=ie.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,t=n.nodes[e];if(!t.extensions||!t.extensions[this.name]||t.mesh===void 0)return null;const r=n.meshes[t.mesh];for(const u of r.primitives)if(u.mode!==Xe.TRIANGLES&&u.mode!==Xe.TRIANGLE_STRIP&&u.mode!==Xe.TRIANGLE_FAN&&u.mode!==void 0)return null;const s=t.extensions[this.name].attributes,c=[],l={};for(const u in s)c.push(this.parser.getDependency("accessor",s[u]).then(f=>(l[u]=f,l[u])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(u=>{const f=u.pop(),h=f.isGroup?f.children:[f],p=u[0].count,y=[];for(const M of h){const b=new Lt,T=new J,x=new It,_=new J(1,1,1),F=new Hs(M.geometry,M.material,p);for(let O=0;O<p;O++)l.TRANSLATION&&T.fromBufferAttribute(l.TRANSLATION,O),l.ROTATION&&x.fromBufferAttribute(l.ROTATION,O),l.SCALE&&_.fromBufferAttribute(l.SCALE,O),F.setMatrixAt(O,b.compose(T,x,_));for(const O in l)if(O==="_COLOR_0"){const A=l[O];F.instanceColor=new Bs(A.array,A.itemSize,A.normalized)}else O!=="TRANSLATION"&&O!=="ROTATION"&&O!=="SCALE"&&M.geometry.setAttribute(O,l[O]);Sr.prototype.copy.call(F,M),this.parser.assignFinalMaterial(F),y.push(F)}return f.isGroup?(f.clear(),f.add(...y),f):y[0]}))}}const Yr="glTF",rn=12,gr={JSON:1313821514,BIN:5130562};class no{constructor(e){this.name=ie.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,rn),t=new TextDecoder;if(this.header={magic:t.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Yr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-rn,i=new DataView(e,rn);let s=0;for(;s<r;){const c=i.getUint32(s,!0);s+=4;const l=i.getUint32(s,!0);if(s+=4,l===gr.JSON){const u=new Uint8Array(e,rn+s,c);this.content=t.decode(u)}else if(l===gr.BIN){const u=rn+s;this.body=e.slice(u,u+c)}s+=c}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ro{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ie.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const t=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,c={},l={},u={};for(const f in s){const h=jn[f]||f.toLowerCase();c[h]=s[f]}for(const f in e.attributes){const h=jn[f]||f.toLowerCase();if(s[f]!==void 0){const p=t.accessors[e.attributes[f]],y=Zt[p.componentType];u[h]=y.name,l[h]=p.normalized===!0}}return n.getDependency("bufferView",i).then(function(f){return new Promise(function(h,p){r.decodeDracoFile(f,function(y){for(const M in y.attributes){const b=y.attributes[M],T=l[M];T!==void 0&&(b.normalized=T)}h(y)},c,u,je,p)})})}}class so{constructor(){this.name=ie.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class io{constructor(){this.name=ie.KHR_MESH_QUANTIZATION}}class $r extends ci{constructor(e,n,t,r){super(e,n,t,r)}copySampleValue_(e){const n=this.resultBuffer,t=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let s=0;s!==r;s++)n[s]=t[i+s];return n}interpolate_(e,n,t,r){const i=this.resultBuffer,s=this.sampleValues,c=this.valueSize,l=c*2,u=c*3,f=r-n,h=(t-n)/f,p=h*h,y=p*h,M=e*u,b=M-u,T=-2*y+3*p,x=y-p,_=1-T,F=x-p+h;for(let O=0;O!==c;O++){const A=s[b+O+c],w=s[b+O+l]*f,P=s[M+O+c],L=s[M+O]*f;i[O]=_*A+F*w+T*P+x*L}return i}}const ao=new It;class oo extends $r{interpolate_(e,n,t,r){const i=super.interpolate_(e,n,t,r);return ao.fromArray(i).normalize().toArray(i),i}}const Xe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Zt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},vr={9728:xn,9729:Be,9984:Ks,9985:Zs,9986:Ws,9987:Ar},yr={33071:lt,33648:Vs,10497:Un},Cn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},jn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},gt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},co={CUBICSPLINE:void 0,LINEAR:Lr,STEP:ii},On={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function lo(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new Ir({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:oi})),o.DefaultMaterial}function St(o,e,n){for(const t in n.extensions)o[t]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[t]=n.extensions[t])}function ct(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function uo(o,e,n){let t=!1,r=!1,i=!1;for(let u=0,f=e.length;u<f;u++){const h=e[u];if(h.POSITION!==void 0&&(t=!0),h.NORMAL!==void 0&&(r=!0),h.COLOR_0!==void 0&&(i=!0),t&&r&&i)break}if(!t&&!r&&!i)return Promise.resolve(o);const s=[],c=[],l=[];for(let u=0,f=e.length;u<f;u++){const h=e[u];if(t){const p=h.POSITION!==void 0?n.getDependency("accessor",h.POSITION):o.attributes.position;s.push(p)}if(r){const p=h.NORMAL!==void 0?n.getDependency("accessor",h.NORMAL):o.attributes.normal;c.push(p)}if(i){const p=h.COLOR_0!==void 0?n.getDependency("accessor",h.COLOR_0):o.attributes.color;l.push(p)}}return Promise.all([Promise.all(s),Promise.all(c),Promise.all(l)]).then(function(u){const f=u[0],h=u[1],p=u[2];return t&&(o.morphAttributes.position=f),r&&(o.morphAttributes.normal=h),i&&(o.morphAttributes.color=p),o.morphTargetsRelative=!0,o})}function ho(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let n=0,t=e.weights.length;n<t;n++)o.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(o.morphTargetInfluences.length===n.length){o.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)o.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function fo(o){let e;const n=o.extensions&&o.extensions[ie.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+Pn(n.attributes):e=o.indices+":"+Pn(o.attributes)+":"+o.mode,o.targets!==void 0)for(let t=0,r=o.targets.length;t<r;t++)e+=":"+Pn(o.targets[t]);return e}function Pn(o){let e="";const n=Object.keys(o).sort();for(let t=0,r=n.length;t<r;t++)e+=n[t]+":"+o[n[t]]+";";return e}function zn(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function po(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":o.search(/\.ktx2($|\?)/i)>0||o.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const mo=new Lt;class go{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new Ua,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let t=!1,r=-1,i=!1,s=-1;if(typeof navigator<"u"){const c=navigator.userAgent;t=/^((?!chrome|android).)*safari/i.test(c)===!0;const l=c.match(/Version\/(\d+)/);r=t&&l?parseInt(l[1],10):-1,i=c.indexOf("Firefox")>-1,s=i?c.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||t&&r<17||i&&s<98?this.textureLoader=new js(this.options.manager):this.textureLoader=new zs(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new wt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const t=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([t.getDependencies("scene"),t.getDependencies("animation"),t.getDependencies("camera")])}).then(function(s){const c={scene:s[0][r.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:r.asset,parser:t,userData:{}};return St(i,c,r),ct(c,r),Promise.all(t._invokeAll(function(l){return l.afterRoot&&l.afterRoot(c)})).then(function(){for(const l of c.scenes)l.updateMatrixWorld();e(c)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],t=this.json.meshes||[];for(let r=0,i=n.length;r<i;r++){const s=n[r].joints;for(let c=0,l=s.length;c<l;c++)e[s[c]].isBone=!0}for(let r=0,i=e.length;r<i;r++){const s=e[r];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(t[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,t){if(e.refs[n]<=1)return t;const r=t.clone(),i=(s,c)=>{const l=this.associations.get(s);l!=null&&this.associations.set(c,l);for(const[u,f]of s.children.entries())i(f,c.children[u])};return i(t,r),r.name+="_instance_"+e.uses[n]++,r}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let t=0;t<n.length;t++){const r=e(n[t]);if(r)return r}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const t=[];for(let r=0;r<n.length;r++){const i=e(n[r]);i&&t.push(i)}return t}getDependency(e,n){const t=e+":"+n;let r=this.cache.get(t);if(!r){switch(e){case"scene":r=this.loadScene(n);break;case"node":r=this._invokeOne(function(i){return i.loadNode&&i.loadNode(n)});break;case"mesh":r=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(n)});break;case"accessor":r=this.loadAccessor(n);break;case"bufferView":r=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(n)});break;case"buffer":r=this.loadBuffer(n);break;case"material":r=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(n)});break;case"texture":r=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(n)});break;case"skin":r=this.loadSkin(n);break;case"animation":r=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(n)});break;case"camera":r=this.loadCamera(n);break;default:if(r=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,n)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(t,r)}return r}getDependencies(e){let n=this.cache.get(e);if(!n){const t=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(r.map(function(i,s){return t.getDependency(e,s)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],t=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[ie.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(i,s){t.load(on.resolveURL(n.uri,r.path),i,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(t){const r=n.byteLength||0,i=n.byteOffset||0;return t.slice(i,i+r)})}loadAccessor(e){const n=this,t=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const s=Cn[r.type],c=Zt[r.componentType],l=r.normalized===!0,u=new c(r.count*s);return Promise.resolve(new an(u,s,l))}const i=[];return r.bufferView!==void 0?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),r.sparse!==void 0&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(s){const c=s[0],l=Cn[r.type],u=Zt[r.componentType],f=u.BYTES_PER_ELEMENT,h=f*l,p=r.byteOffset||0,y=r.bufferView!==void 0?t.bufferViews[r.bufferView].byteStride:void 0,M=r.normalized===!0;let b,T;if(y&&y!==h){const x=Math.floor(p/y),_="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+x+":"+r.count;let F=n.cache.get(_);F||(b=new u(c,x*y,r.count*y/f),F=new Gs(b,y/f),n.cache.add(_,F)),T=new ai(F,l,p%y/f,M)}else c===null?b=new u(r.count*l):b=new u(c,p,r.count*l),T=new an(b,l,M);if(r.sparse!==void 0){const x=Cn.SCALAR,_=Zt[r.sparse.indices.componentType],F=r.sparse.indices.byteOffset||0,O=r.sparse.values.byteOffset||0,A=new _(s[1],F,r.sparse.count*x),w=new u(s[2],O,r.sparse.count*l);c!==null&&(T=new an(T.array.slice(),T.itemSize,T.normalized)),T.normalized=!1;for(let P=0,L=A.length;P<L;P++){const I=A[P];if(T.setX(I,w[P*l]),l>=2&&T.setY(I,w[P*l+1]),l>=3&&T.setZ(I,w[P*l+2]),l>=4&&T.setW(I,w[P*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}T.normalized=M}return T})}loadTexture(e){const n=this.json,t=this.options,i=n.textures[e].source,s=n.images[i];let c=this.textureLoader;if(s.uri){const l=t.manager.getHandler(s.uri);l!==null&&(c=l)}return this.loadTextureImage(e,i,c)}loadTextureImage(e,n,t){const r=this,i=this.json,s=i.textures[e],c=i.images[n],l=(c.uri||c.bufferView)+":"+s.sampler;if(this.textureCache[l])return this.textureCache[l];const u=this.loadImageSource(n,t).then(function(f){f.flipY=!1,f.name=s.name||c.name||"",f.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(f.name=c.uri);const p=(i.samplers||{})[s.sampler]||{};return f.magFilter=vr[p.magFilter]||Be,f.minFilter=vr[p.minFilter]||Ar,f.wrapS=yr[p.wrapS]||Un,f.wrapT=yr[p.wrapT]||Un,f.generateMipmaps=!f.isCompressedTexture&&f.minFilter!==xn&&f.minFilter!==Be,r.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[l]=u,u}loadImageSource(e,n){const t=this,r=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const s=r.images[e],c=self.URL||self.webkitURL;let l=s.uri||"",u=!1;if(s.bufferView!==void 0)l=t.getDependency("bufferView",s.bufferView).then(function(h){u=!0;const p=new Blob([h],{type:s.mimeType});return l=c.createObjectURL(p),l});else if(s.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(l).then(function(h){return new Promise(function(p,y){let M=p;n.isImageBitmapLoader===!0&&(M=function(b){const T=new vt(b);T.needsUpdate=!0,p(T)}),n.load(on.resolveURL(h,i.path),M,void 0,y)})}).then(function(h){return u===!0&&c.revokeObjectURL(l),ct(h,s),h.userData.mimeType=s.mimeType||po(s.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[e]=f,f}assignTexture(e,n,t,r){const i=this;return this.getDependency("texture",t.index).then(function(s){if(!s)return null;if(t.texCoord!==void 0&&t.texCoord>0&&(s=s.clone(),s.channel=t.texCoord),i.extensions[ie.KHR_TEXTURE_TRANSFORM]){const c=t.extensions!==void 0?t.extensions[ie.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const l=i.associations.get(s);s=i.extensions[ie.KHR_TEXTURE_TRANSFORM].extendTexture(s,c),i.associations.set(s,l)}}return r!==void 0&&(s.colorSpace=r),e[n]=s,s})}assignFinalMaterial(e){const n=e.geometry;let t=e.material;const r=n.attributes.tangent===void 0,i=n.attributes.color!==void 0,s=n.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+t.uuid;let l=this.cache.get(c);l||(l=new Xs,Rn.prototype.copy.call(l,t),l.color.copy(t.color),l.map=t.map,l.sizeAttenuation=!1,this.cache.add(c,l)),t=l}else if(e.isLine){const c="LineBasicMaterial:"+t.uuid;let l=this.cache.get(c);l||(l=new Ys,Rn.prototype.copy.call(l,t),l.color.copy(t.color),l.map=t.map,this.cache.add(c,l)),t=l}if(r||i||s){let c="ClonedMaterial:"+t.uuid+":";r&&(c+="derivative-tangents:"),i&&(c+="vertex-colors:"),s&&(c+="flat-shading:");let l=this.cache.get(c);l||(l=t.clone(),i&&(l.vertexColors=!0),s&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(c,l),this.associations.set(l,this.associations.get(t))),t=l}e.material=t}getMaterialType(){return Ir}loadMaterial(e){const n=this,t=this.json,r=this.extensions,i=t.materials[e];let s;const c={},l=i.extensions||{},u=[];if(l[ie.KHR_MATERIALS_UNLIT]){const h=r[ie.KHR_MATERIALS_UNLIT];s=h.getMaterialType(),u.push(h.extendParams(c,i,n))}else{const h=i.pbrMetallicRoughness||{};if(c.color=new tt(1,1,1),c.opacity=1,Array.isArray(h.baseColorFactor)){const p=h.baseColorFactor;c.color.setRGB(p[0],p[1],p[2],je),c.opacity=p[3]}h.baseColorTexture!==void 0&&u.push(n.assignTexture(c,"map",h.baseColorTexture,dt)),c.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,c.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(u.push(n.assignTexture(c,"metalnessMap",h.metallicRoughnessTexture)),u.push(n.assignTexture(c,"roughnessMap",h.metallicRoughnessTexture))),s=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,c)})))}i.doubleSided===!0&&(c.side=Wn);const f=i.alphaMode||On.OPAQUE;if(f===On.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,f===On.MASK&&(c.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&s!==zt&&(u.push(n.assignTexture(c,"normalMap",i.normalTexture)),c.normalScale=new Fe(1,1),i.normalTexture.scale!==void 0)){const h=i.normalTexture.scale;c.normalScale.set(h,h)}if(i.occlusionTexture!==void 0&&s!==zt&&(u.push(n.assignTexture(c,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&s!==zt){const h=i.emissiveFactor;c.emissive=new tt().setRGB(h[0],h[1],h[2],je)}return i.emissiveTexture!==void 0&&s!==zt&&u.push(n.assignTexture(c,"emissiveMap",i.emissiveTexture,dt)),Promise.all(u).then(function(){const h=new s(c);return i.name&&(h.name=i.name),ct(h,i),n.associations.set(h,{materials:e}),i.extensions&&St(r,h,i),h})}createUniqueName(e){const n=$s.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,t=this.extensions,r=this.primitiveCache;function i(c){return t[ie.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,n).then(function(l){return wr(l,c,n)})}const s=[];for(let c=0,l=e.length;c<l;c++){const u=e[c],f=fo(u),h=r[f];if(h)s.push(h.promise);else{let p;u.extensions&&u.extensions[ie.KHR_DRACO_MESH_COMPRESSION]?p=i(u):p=wr(new Rr,u,n),r[f]={primitive:u,promise:p},s.push(p)}}return Promise.all(s)}loadMesh(e){const n=this,t=this.json,r=this.extensions,i=t.meshes[e],s=i.primitives,c=[];for(let l=0,u=s.length;l<u;l++){const f=s[l].material===void 0?lo(this.cache):this.getDependency("material",s[l].material);c.push(f)}return c.push(n.loadGeometries(s)),Promise.all(c).then(function(l){const u=l.slice(0,l.length-1),f=l[l.length-1],h=[];for(let y=0,M=f.length;y<M;y++){const b=f[y],T=s[y];let x;const _=u[y];if(T.mode===Xe.TRIANGLES||T.mode===Xe.TRIANGLE_STRIP||T.mode===Xe.TRIANGLE_FAN||T.mode===void 0)x=i.isSkinnedMesh===!0?new qs(b,_):new hn(b,_),x.isSkinnedMesh===!0&&x.normalizeSkinWeights(),T.mode===Xe.TRIANGLE_STRIP?x.geometry=mr(x.geometry,Mr):T.mode===Xe.TRIANGLE_FAN&&(x.geometry=mr(x.geometry,Nn));else if(T.mode===Xe.LINES)x=new Qs(b,_);else if(T.mode===Xe.LINE_STRIP)x=new Js(b,_);else if(T.mode===Xe.LINE_LOOP)x=new ei(b,_);else if(T.mode===Xe.POINTS)x=new ti(b,_);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+T.mode);Object.keys(x.geometry.morphAttributes).length>0&&ho(x,i),x.name=n.createUniqueName(i.name||"mesh_"+e),ct(x,i),T.extensions&&St(r,x,T),n.assignFinalMaterial(x),h.push(x)}for(let y=0,M=h.length;y<M;y++)n.associations.set(h[y],{meshes:e,primitives:y});if(h.length===1)return i.extensions&&St(r,h[0],i),h[0];const p=new Sn;i.extensions&&St(r,p,i),n.associations.set(p,{meshes:e});for(let y=0,M=h.length;y<M;y++)p.add(h[y]);return p})}loadCamera(e){let n;const t=this.json.cameras[e],r=t[t.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return t.type==="perspective"?n=new Gt(sn.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):t.type==="orthographic"&&(n=new At(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),t.name&&(n.name=this.createUniqueName(t.name)),ct(n,t),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],t=[];for(let r=0,i=n.joints.length;r<i;r++)t.push(this._loadNodeShallow(n.joints[r]));return n.inverseBindMatrices!==void 0?t.push(this.getDependency("accessor",n.inverseBindMatrices)):t.push(null),Promise.all(t).then(function(r){const i=r.pop(),s=r,c=[],l=[];for(let u=0,f=s.length;u<f;u++){const h=s[u];if(h){c.push(h);const p=new Lt;i!==null&&p.fromArray(i.array,u*16),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[u])}return new ni(c,l)})}loadAnimation(e){const n=this.json,t=this,r=n.animations[e],i=r.name?r.name:"animation_"+e,s=[],c=[],l=[],u=[],f=[];for(let h=0,p=r.channels.length;h<p;h++){const y=r.channels[h],M=r.samplers[y.sampler],b=y.target,T=b.node,x=r.parameters!==void 0?r.parameters[M.input]:M.input,_=r.parameters!==void 0?r.parameters[M.output]:M.output;b.node!==void 0&&(s.push(this.getDependency("node",T)),c.push(this.getDependency("accessor",x)),l.push(this.getDependency("accessor",_)),u.push(M),f.push(b))}return Promise.all([Promise.all(s),Promise.all(c),Promise.all(l),Promise.all(u),Promise.all(f)]).then(function(h){const p=h[0],y=h[1],M=h[2],b=h[3],T=h[4],x=[];for(let _=0,F=p.length;_<F;_++){const O=p[_],A=y[_],w=M[_],P=b[_],L=T[_];if(O===void 0)continue;O.updateMatrix&&O.updateMatrix();const I=t._createAnimationTracks(O,A,w,P,L);if(I)for(let C=0;C<I.length;C++)x.push(I[C])}return new ri(i,void 0,x)})}createNodeMesh(e){const n=this.json,t=this,r=n.nodes[e];return r.mesh===void 0?null:t.getDependency("mesh",r.mesh).then(function(i){const s=t._getNodeRef(t.meshCache,r.mesh,i);return r.weights!==void 0&&s.traverse(function(c){if(c.isMesh)for(let l=0,u=r.weights.length;l<u;l++)c.morphTargetInfluences[l]=r.weights[l]}),s})}loadNode(e){const n=this.json,t=this,r=n.nodes[e],i=t._loadNodeShallow(e),s=[],c=r.children||[];for(let u=0,f=c.length;u<f;u++)s.push(t.getDependency("node",c[u]));const l=r.skin===void 0?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([i,Promise.all(s),l]).then(function(u){const f=u[0],h=u[1],p=u[2];p!==null&&f.traverse(function(y){y.isSkinnedMesh&&y.bind(p,mo)});for(let y=0,M=h.length;y<M;y++)f.add(h[y]);return f})}_loadNodeShallow(e){const n=this.json,t=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=n.nodes[e],s=i.name?r.createUniqueName(i.name):"",c=[],l=r._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return l&&c.push(l),i.camera!==void 0&&c.push(r.getDependency("camera",i.camera).then(function(u){return r._getNodeRef(r.cameraCache,i.camera,u)})),r._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){c.push(u)}),this.nodeCache[e]=Promise.all(c).then(function(u){let f;if(i.isBone===!0?f=new si:u.length>1?f=new Sn:u.length===1?f=u[0]:f=new Sr,f!==u[0])for(let h=0,p=u.length;h<p;h++)f.add(u[h]);if(i.name&&(f.userData.name=i.name,f.name=s),ct(f,i),i.extensions&&St(t,f,i),i.matrix!==void 0){const h=new Lt;h.fromArray(i.matrix),f.applyMatrix4(h)}else i.translation!==void 0&&f.position.fromArray(i.translation),i.rotation!==void 0&&f.quaternion.fromArray(i.rotation),i.scale!==void 0&&f.scale.fromArray(i.scale);if(!r.associations.has(f))r.associations.set(f,{});else if(i.mesh!==void 0&&r.meshCache.refs[i.mesh]>1){const h=r.associations.get(f);r.associations.set(f,{...h})}return r.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const n=this.extensions,t=this.json.scenes[e],r=this,i=new Sn;t.name&&(i.name=r.createUniqueName(t.name)),ct(i,t),t.extensions&&St(n,i,t);const s=t.nodes||[],c=[];for(let l=0,u=s.length;l<u;l++)c.push(r.getDependency("node",s[l]));return Promise.all(c).then(function(l){for(let f=0,h=l.length;f<h;f++)i.add(l[f]);const u=f=>{const h=new Map;for(const[p,y]of r.associations)(p instanceof Rn||p instanceof vt)&&h.set(p,y);return f.traverse(p=>{const y=r.associations.get(p);y!=null&&h.set(p,y)}),h};return r.associations=u(i),i})}_createAnimationTracks(e,n,t,r,i){const s=[],c=e.name?e.name:e.uuid,l=[];gt[i.path]===gt.weights?e.traverse(function(p){p.morphTargetInfluences&&l.push(p.name?p.name:p.uuid)}):l.push(c);let u;switch(gt[i.path]){case gt.weights:u=cr;break;case gt.rotation:u=lr;break;case gt.translation:case gt.scale:u=or;break;default:switch(t.itemSize){case 1:u=cr;break;case 2:case 3:default:u=or;break}break}const f=r.interpolation!==void 0?co[r.interpolation]:Lr,h=this._getArrayFromAccessor(t);for(let p=0,y=l.length;p<y;p++){const M=new u(l[p]+"."+gt[i.path],n.array,h,f);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(M),s.push(M)}return s}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const t=zn(n.constructor),r=new Float32Array(n.length);for(let i=0,s=n.length;i<s;i++)r[i]=n[i]*t;n=r}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){const r=this instanceof lr?oo:$r;return new r(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function vo(o,e,n){const t=e.attributes,r=new Zn;if(t.POSITION!==void 0){const c=n.json.accessors[t.POSITION],l=c.min,u=c.max;if(l!==void 0&&u!==void 0){if(r.set(new J(l[0],l[1],l[2]),new J(u[0],u[1],u[2])),c.normalized){const f=zn(Zt[c.componentType]);r.min.multiplyScalar(f),r.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const c=new J,l=new J;for(let u=0,f=i.length;u<f;u++){const h=i[u];if(h.POSITION!==void 0){const p=n.json.accessors[h.POSITION],y=p.min,M=p.max;if(y!==void 0&&M!==void 0){if(l.setX(Math.max(Math.abs(y[0]),Math.abs(M[0]))),l.setY(Math.max(Math.abs(y[1]),Math.abs(M[1]))),l.setZ(Math.max(Math.abs(y[2]),Math.abs(M[2]))),p.normalized){const b=zn(Zt[p.componentType]);l.multiplyScalar(b)}c.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(c)}o.boundingBox=r;const s=new xr;r.getCenter(s.center),s.radius=r.min.distanceTo(r.max)/2,o.boundingSphere=s}function wr(o,e,n){const t=e.attributes,r=[];function i(s,c){return n.getDependency("accessor",s).then(function(l){o.setAttribute(c,l)})}for(const s in t){const c=jn[s]||s.toLowerCase();c in o.attributes||r.push(i(t[s],c))}if(e.indices!==void 0&&!o.index){const s=n.getDependency("accessor",e.indices).then(function(c){o.setIndex(c)});r.push(s)}return Fn.workingColorSpace!==je&&"COLOR_0"in t&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Fn.workingColorSpace}" not supported.`),ct(o,e),vo(o,e,n),Promise.all(r).then(function(){return e.targets!==void 0?uo(o,e.targets,n):o})}function To(){const[o,e]=v.useState(!1),n=v.useRef(null);return v.useEffect(()=>{const t=new IntersectionObserver(r=>{r[0].isIntersecting&&e(!0)},{threshold:.2});return n.current&&t.observe(n.current),()=>t.disconnect()},[]),ye.jsxs("section",{ref:n,className:"relative w-full min-h-[600px] bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 rounded-2xl p-6 flex flex-col items-center justify-center overflow-hidden",children:[ye.jsx("h2",{className:"text-2xl sm:text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-indigo-400 to-purple-400 animate-gradient-glow mb-3 text-center",children:"ESP32-S3 3D Interactive Overview"}),ye.jsx("p",{className:"text-blue-200 text-center max-w-xl mx-auto mb-6",children:"Drag to rotate, scroll or pan to zoom, and get a closer look at its key components."}),ye.jsx("div",{className:"relative w-full h-[350px] md:h-[500px]",children:o&&ye.jsxs(mi,{shadows:!0,camera:{position:[0,1.5,3],fov:45},gl:{antialias:!0,powerPreference:"high-performance"},performance:{min:.5},children:[ye.jsx("ambientLight",{intensity:.6}),ye.jsx("directionalLight",{position:[5,5,5],intensity:1.2,castShadow:!0}),ye.jsx("directionalLight",{position:[-5,5,5],intensity:.8}),ye.jsx("spotLight",{position:[0,5,0],angle:.4,penumbra:.5,intensity:.9,castShadow:!0}),ye.jsx(v.Suspense,{fallback:ye.jsx(Mi,{center:!0,children:ye.jsx("span",{className:"text-white text-lg",children:"Loading ESP32-S3..."})}),children:ye.jsx(Oa,{shadows:"contact",adjustCamera:!1,intensity:0,children:ye.jsx(yo,{})})}),ye.jsx(ea,{enablePan:!0,enableZoom:!0,enableRotate:!0,maxPolarAngle:Math.PI/2,minDistance:2,maxDistance:6}),ye.jsx(Pa,{all:!0})]})})]})}function yo(){const{scene:o}=un(Fa,"/models/esp32-s3-draco.glb",e=>{const n=new Da;n.setDecoderPath("/draco/"),e.setDRACOLoader(n)});return ye.jsx("primitive",{object:o,scale:35,position:[0,-.5,0]})}export{To as default};
