#
# GitHub Actions Workflow for Vercel Preview Deployments
#
# This workflow is triggered on pull requests to automatically build and deploy
# a preview version of your application to Vercel.
#
# It combines the build, deployment, and PR commenting steps into a single,
# robust pipeline.
#

name: Vercel Preview

on:
  pull_request:
    types: [opened, synchronize]
    # Restrict workflow to specific branches for performance, e.g.,
    # branches:
    #   - main
    #   - develop

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¦ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Set up Node.js 22.x
        uses: actions/setup-node@v4
        with:
          node-version: 22.x

      # The Vercel GitHub integration can handle the build and deployment itself.
      # You can run your own build and deployment steps if you have a custom setup,
      # but Vercel's official action is more reliable and integrates better.
      # This step handles the entire deployment process.
      - name: ğŸš€ Deploy to Vercel
        id: vercel-deploy
        uses: vercel/actions/deploy-pull-request@v1
        with:
          # Your Vercel token, project ID, and organization ID are required secrets.
          # These are typically configured in your repository settings.
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          # Project and Org ID are automatically detected, so you don't need to specify them here.
          # vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          # vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          
      - name: ğŸ“ Post Vercel Preview Comment
        id: create-comment
        uses: peter-evans/create-or-update-comment@v4
        with:
          # This token is automatically provided by GitHub Actions for every workflow run.
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            ğŸš€ **Vercel Preview Available**
            
            This deployment was handled by Vercel's official GitHub Action.
            
            ğŸ”— [View Live Preview](${{ steps.vercel-deploy.outputs.url }})

            ğŸ“± Scan on mobile:
            ![QR Code](https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${{ steps.vercel-deploy.outputs.url }})

            ğŸ§ª This preview is for PR #${{ github.event.pull_request.number }}.